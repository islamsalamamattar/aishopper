2025-01-08 08:57:11,996 [INFO] app.logs.logger: Starting MessageChain for session_id: 5eacdb22-4d79-417c-9f7f-96d5f38f4463 with message: hi
2025-01-08 08:57:12,001 [INFO] app.logs.logger: Initializing ConversationState for session_id: 5eacdb22-4d79-417c-9f7f-96d5f38f4463
2025-01-08 08:57:12,008 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae
2025-01-08 08:57:12,010 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-08 08:57:12,851 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-08 08:57:12,866 [INFO] app.logs.logger: INTERACTION SAVED:cae8dab2-d64f-4d22-afbc-36d4766ba7e9
2025-01-09 17:35:29,756 [INFO] app.logs.logger: Starting MessageChain for session_id: d2ca8b86-1491-4531-8fe4-61244c6ca17b with message: hey babe
2025-01-09 17:35:29,758 [INFO] app.logs.logger: Initializing ConversationState for session_id: d2ca8b86-1491-4531-8fe4-61244c6ca17b
2025-01-09 17:35:29,761 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae
2025-01-09 17:35:29,763 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 17:35:31,232 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-09 17:35:31,240 [INFO] app.logs.logger: INTERACTION SAVED:dbe3ef0c-6891-4bd3-a171-ad58620a53c8
2025-01-09 17:35:59,051 [INFO] app.logs.logger: Starting MessageChain for session_id: d2ca8b86-1491-4531-8fe4-61244c6ca17b with message: boxing shoes for sparring
2025-01-09 17:35:59,054 [INFO] app.logs.logger: Initializing ConversationState for session_id: d2ca8b86-1491-4531-8fe4-61244c6ca17b
2025-01-09 17:35:59,057 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae
2025-01-09 17:35:59,060 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 17:35:59,854 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['boxing shoes', 'sparring'], 'search_index': 'apparel'}
2025-01-09 17:35:59,855 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-09 17:35:59,868 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-09 17:36:06,780 [INFO] app.logs.logger: Saving interaction to database.
2025-01-09 17:36:06,785 [INFO] app.logs.logger: INTERACTION SAVED:bd02d5c7-992d-4bf0-8198-c57a35a37e0c
2025-01-09 17:36:06,785 [INFO] app.logs.logger: Formatting state for app response.
2025-01-09 17:47:44,313 [INFO] app.logs.logger: Received chat request for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:47:44,319 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 17:47:44,320 [INFO] app.logs.logger: Processing message for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:47:44,320 [INFO] app.logs.logger: Starting MessageChain for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008 with message: Hi
2025-01-09 17:47:44,323 [INFO] app.logs.logger: Initializing ConversationState for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:47:44,328 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae
2025-01-09 17:47:44,329 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 17:47:45,374 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-09 17:47:45,385 [INFO] app.logs.logger: INTERACTION SAVED:31da0383-cde1-4fdd-8855-408bbd4263bc
2025-01-09 17:47:45,385 [INFO] app.logs.logger: Formatting app reply for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:47:45,386 [INFO] app.logs.logger: Returning response for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:49:54,003 [INFO] app.logs.logger: Received chat request for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:49:54,093 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 17:49:54,094 [INFO] app.logs.logger: Processing message for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:49:54,095 [INFO] app.logs.logger: Starting MessageChain for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008 with message: massage device
2025-01-09 17:49:54,098 [INFO] app.logs.logger: Initializing ConversationState for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:49:54,104 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae
2025-01-09 17:49:54,129 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 17:49:54,859 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['massage device'], 'search_index': 'All'}
2025-01-09 17:49:54,859 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-09 17:49:54,869 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-09 17:50:02,563 [INFO] app.logs.logger: Saving interaction to database.
2025-01-09 17:50:02,574 [INFO] app.logs.logger: INTERACTION SAVED:417bc939-76cb-48f4-a68e-563bfb733eb2
2025-01-09 17:50:02,574 [INFO] app.logs.logger: Formatting state for app response.
2025-01-09 17:50:02,575 [INFO] app.logs.logger: Formatting app reply for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:50:02,575 [INFO] app.logs.logger: Returning response for session_id: 254bbadd-8cbe-46d3-93f8-5804f6527008
2025-01-09 17:50:02,575 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('bbdffa48-e33f-41ea-9650-0b5bc3d5bf38'), 'interaction_id': UUID('417bc939-76cb-48f4-a68e-563bfb733eb2'), 'role': 'assistant', 'createdAt': 1736445002575, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B01BZOKLOO', 'name': 'Nekteck Shiatsu Neck and Back Massager with Soothing Heat, Electric Deep Tissue 3D Kneading Massage Pillow for Shoulder, Leg, Body Muscle Pain Relief, Home, Office, and Car Use', 'images': ['https://m.media-amazon.com/images/I/71PGkxLq-DL.jpg'], 'currency': 'AED', 'price': 199.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DNYX8YS4', 'name': 'Massage Gun Deep Tissue Percussion Massager,Portable Handheld Muscle Relaxation Electric Sport Massager,10 Heads 7 Speed Level, Upgrade Super Quiet,Help Back Neck Relieve Muscle Soreness and Stiffness', 'images': ['https://m.media-amazon.com/images/I/613HHzxrWoL.jpg'], 'currency': 'AED', 'price': 104.0, 'rating': 5.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CF614PH6', 'name': 'cotsoco Massage Gun, Muscle Percussion Massager with 6 Speeds, Quiet Hand Massager, Massage Gun for Shoulder, Body, Back Relaxation, Portable Massager, gold-coloured', 'images': ['https://m.media-amazon.com/images/I/71MzhHE3l0L.jpg'], 'currency': 'AED', 'price': 31.0, 'rating': 3.6}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09LQ6DY5Z', 'name': 'arboleaf Mini Massage Gun, Percussion Deep Tissues Muscle Massager, Travel Massage Gun, Portable Handheld Massager, Ultra-Quiet Compact Massager for Sports, Office, Home, Perfect for Pain Relief', 'images': ['https://m.media-amazon.com/images/I/71ilJuvciGL.jpg'], 'currency': 'AED', 'price': 161.0, 'rating': 4.7}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0D16W8531', 'name': 'BOB AND BRAD Q2 Pro Mini Massage Gun with Heat and Cold Head, Pocket-Sized Deep Tissue Massager Gun, Portable Percussion Muscle Massager Gun, Ultra Small & Quiet Muscle Massage Gun with Carry Case', 'images': ['https://m.media-amazon.com/images/I/71VUVbpqe7L.jpg'], 'currency': 'AED', 'price': 286.0, 'rating': 4.7}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B08ZD19WYL', 'name': 'Medcursor Massage Gun, High Intensity Brushless Motor, Muscle Massage Gun Deep Tissue for Athletes with 6 Massage Heads, Electric Percussion Massager for Any Pain Relief, Gifts for Father/Dad (Black)', 'images': ['https://m.media-amazon.com/images/I/719O-RReXyL.jpg'], 'currency': 'AED', 'price': 198.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B07VT1MMZ8', 'name': 'cotsoco Handheld Massager Mini Portable Vibrating Body Massager with LED Light for Hand Head Neck Back Legs Arms Pain Release, Battery Operated, Easy Hand Grip', 'images': ['https://m.media-amazon.com/images/I/51tuNmyqJkL.jpg'], 'currency': 'AED', 'price': 53.0, 'rating': 4.1}]}]
2025-01-09 18:07:25,415 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-09 18:07:25,496 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:25,497 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-09 18:07:25,510 [INFO] app.logs.logger: Successfully created new chat session with session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-09 18:07:25,614 [INFO] app.logs.logger: Received chat_history request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-09 18:07:25,617 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-09 18:07:25,618 [INFO] app.logs.logger: Fetching interactions for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-09 18:07:25,647 [INFO] app.logs.logger: No interactions found for session_id: 99f902ac-3d62-431c-a90b-13a22f966756. Returning default greeting.
2025-01-09 18:07:27,945 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-09 18:07:27,953 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:27,953 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:27,959 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:29,595 [INFO] app.logs.logger: Received chat_history request for session_id: 26c620a1-b8cd-49e8-8cb4-275a75bfea00
2025-01-09 18:07:29,601 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-09 18:07:29,601 [INFO] app.logs.logger: Fetching interactions for session_id: 26c620a1-b8cd-49e8-8cb4-275a75bfea00
2025-01-09 18:07:29,604 [INFO] app.logs.logger: Formatted chat history for session_id: 26c620a1-b8cd-49e8-8cb4-275a75bfea00
2025-01-09 18:07:41,261 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-09 18:07:41,274 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:41,274 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:41,278 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:07:44,716 [INFO] app.logs.logger: Received chat_history request for session_id: b8f831ed-bd7e-481a-bc16-b9a094484af6
2025-01-09 18:07:44,723 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-09 18:07:44,724 [INFO] app.logs.logger: Fetching interactions for session_id: b8f831ed-bd7e-481a-bc16-b9a094484af6
2025-01-09 18:07:44,727 [INFO] app.logs.logger: Formatted chat history for session_id: b8f831ed-bd7e-481a-bc16-b9a094484af6
2025-01-09 18:08:47,960 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-09 18:08:47,975 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:08:47,976 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:08:47,980 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:08:54,461 [INFO] app.logs.logger: Received chat_history request for session_id: 8c37367e-dd83-45f9-87e6-6d43ad984a99
2025-01-09 18:08:54,466 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-09 18:08:54,467 [INFO] app.logs.logger: Fetching interactions for session_id: 8c37367e-dd83-45f9-87e6-6d43ad984a99
2025-01-09 18:08:54,469 [INFO] app.logs.logger: Formatted chat history for session_id: 8c37367e-dd83-45f9-87e6-6d43ad984a99
2025-01-09 18:14:08,310 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-09 18:14:08,385 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:14:08,388 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-09 18:14:08,403 [INFO] app.logs.logger: Successfully created new chat session with session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:14:08,519 [INFO] app.logs.logger: Received chat_history request for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:14:08,522 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-09 18:14:08,523 [INFO] app.logs.logger: Fetching interactions for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:14:08,544 [INFO] app.logs.logger: No interactions found for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d. Returning default greeting.
2025-01-09 18:14:10,767 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-09 18:14:10,772 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:14:10,773 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:14:10,778 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:15:14,721 [INFO] app.logs.logger: Received chat request for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:14,735 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:15:14,736 [INFO] app.logs.logger: Processing message for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:14,736 [INFO] app.logs.logger: Starting MessageChain for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d with message: hi, what is the average weight for a gold neckless? from to for a normal one
2025-01-09 18:15:14,740 [INFO] app.logs.logger: Initializing ConversationState for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:14,747 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:14,749 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 18:15:19,344 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-09 18:15:19,376 [INFO] app.logs.logger: INTERACTION SAVED:f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,377 [INFO] app.logs.logger: Formatting app reply for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:19,377 [INFO] app.logs.logger: Returning response for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:19,377 [INFO] app.logs.logger: Response:
[{'type': 'text', 'id': UUID('ea2c3cdd-cf08-44d9-8e0f-413154f2512b'), 'interaction_id': UUID('f34bfb9b-f64d-41a6-9475-0e60f02fec40'), 'role': 'assistant', 'createdAt': 1736446519377, 'text': 'Ah, the quest for the perfect gold necklace weight! A "normal" gold necklace typically weighs between 10 to 30 grams. However, it can vary based on the style, thickness, and design. \n\nIf you\'re looking for something specific or need help finding one that fits your taste (and weight preferences), just let me know!'}]
2025-01-09 18:15:19,546 [INFO] app.logs.logger: Received chat_next request for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,551 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:15:19,551 [INFO] app.logs.logger: Fetching interaction with ID: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,553 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,554 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-09 18:15:19,641 [INFO] app.logs.logger: Received chat_next request for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,646 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:15:19,646 [INFO] app.logs.logger: Fetching interaction with ID: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,647 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,648 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-09 18:15:19,736 [INFO] app.logs.logger: Received chat_next request for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,742 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:15:19,742 [INFO] app.logs.logger: Fetching interaction with ID: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,744 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,744 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-09 18:15:19,852 [INFO] app.logs.logger: Received chat_next request for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,855 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:15:19,855 [INFO] app.logs.logger: Fetching interaction with ID: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,856 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,856 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-09 18:15:19,946 [INFO] app.logs.logger: Received chat_next request for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,949 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:15:19,949 [INFO] app.logs.logger: Fetching interaction with ID: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,950 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: f34bfb9b-f64d-41a6-9475-0e60f02fec40
2025-01-09 18:15:19,950 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-09 18:15:49,534 [INFO] app.logs.logger: Received chat request for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:49,567 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:15:49,568 [INFO] app.logs.logger: Processing message for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:49,569 [INFO] app.logs.logger: Starting MessageChain for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d with message: show me some gold necklesses below 3000
2025-01-09 18:15:49,571 [INFO] app.logs.logger: Initializing ConversationState for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:49,575 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:15:49,578 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-09 18:15:50,806 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['gold necklace'], 'search_index': 'jewelry', 'max_price': 3000}
2025-01-09 18:15:50,807 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-09 18:15:50,830 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-09 18:16:08,099 [INFO] app.logs.logger: Saving interaction to database.
2025-01-09 18:16:08,106 [INFO] app.logs.logger: INTERACTION SAVED:5d30fcf7-eb60-4648-bbfd-57a52adeda89
2025-01-09 18:16:08,107 [INFO] app.logs.logger: Formatting state for app response.
2025-01-09 18:16:08,107 [INFO] app.logs.logger: Formatting app reply for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:16:08,107 [INFO] app.logs.logger: Returning response for session_id: c4091f6d-84e4-4236-98b6-9a719b90a89d
2025-01-09 18:16:08,107 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('b45a3dd0-9385-4a3e-bfdb-c6b824b61f47'), 'interaction_id': UUID('5d30fcf7-eb60-4648-bbfd-57a52adeda89'), 'role': 'assistant', 'createdAt': 1736446568107, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B0BY8BFM43', 'name': 'Foxgirl', 'images': ['https://m.media-amazon.com/images/I/5164j8c9p6L.jpg'], 'currency': 'AED', 'price': 18.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0BS6FFD7F', 'name': 'Hipwope', 'images': ['https://m.media-amazon.com/images/I/61HgSWZlAQL.jpg'], 'currency': 'AED', 'price': 41.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09Q33WGZW', 'name': 'Tewiky', 'images': ['https://m.media-amazon.com/images/I/61OHLiIUVVL.jpg'], 'currency': 'AED', 'price': 63.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CLJ5D8J4', 'name': 'Ybaier', 'images': ['https://m.media-amazon.com/images/I/319aqfkIiML.jpg'], 'currency': 'AED', 'price': 29.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0C36RZ7ZV', 'name': 'Klenai', 'images': ['https://m.media-amazon.com/images/I/51qZUhSY8gL.jpg'], 'currency': 'AED', 'price': 27.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0D3RQSSV5', 'name': 'Generic', 'images': ['https://m.media-amazon.com/images/I/51GYDaTJPML.jpg'], 'currency': 'AED', 'price': 13.0, 'rating': 5.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DGKF9JWX', 'name': 'TERRIFI', 'images': ['https://m.media-amazon.com/images/I/71JY+yn53dL.jpg'], 'currency': 'AED', 'price': 49.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0C36T7465', 'name': 'Klenai', 'images': ['https://m.media-amazon.com/images/I/51Kl7rYeacL.jpg'], 'currency': 'AED', 'price': 41.0, 'rating': 4.1}]}, {'type': 'noonProducts', 'id': UUID('67054baa-c9a3-4539-a2c2-3d8977d7fd37'), 'interaction_id': UUID('5d30fcf7-eb60-4648-bbfd-57a52adeda89'), 'role': 'assistant', 'createdAt': 1736446568107, 'products': [{'platform': 'noon', 'country': 'ae', 'asin': 'Z0129174600AE349AAA5DZ', 'name': 'CERRUTI 1881 Cerruti 1881 Ladies Necklace Gold â€“ Classic Elegance for Women ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z0129174600AE349AAA5DZ/45/_/1723716426/612199cf-2169-434c-86d2-3c80afc8eb87.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z0129174600AE349AAA5DZ/45/_/1723716434/978def29-35eb-4c1a-aa52-c43f32a5d522.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z0129174600AE349AAA5DZ/45/_/1723716435/00e27ed9-19e9-42eb-bc61-da7e2f294a2f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z0129174600AE349AAA5DZ/45/_/1723716442/ed5dd771-0a02-4933-b178-b64a2350ab65.jpg'], 'currency': 'AED', 'price': 319.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'ZB35DACD92FD6EA0B1A6DZ', 'name': 'CERRUTI 1881 Gabriella Gold Plated Small Necklace with Crystals ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB35DACD92FD6EA0B1A6DZ/45/_/1725608189/2e2a9498-5bdc-4525-aa70-372df729f661.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB35DACD92FD6EA0B1A6DZ/45/_/1725608191/57bf084d-99cd-4d75-9b9a-6b7353dab553.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB35DACD92FD6EA0B1A6DZ/45/_/1725608195/e3566ced-8a72-40e8-b3db-0f9d236214e2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB35DACD92FD6EA0B1A6DZ/45/_/1725608205/832e28dd-2973-4692-826a-4444c260c9ac.jpg'], 'currency': 'AED', 'price': 400.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z42D60FD6AEDA4EACAF20Z', 'name': 'AWNL Eternal Vow Necklace Pendant With Sterling Silver ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z42D60FD6AEDA4EACAF20Z/45/_/1730271971/3778d2f5-f41d-42e7-8225-4b1e0ae31ef8.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z42D60FD6AEDA4EACAF20Z/45/_/1735115507/0e2c9b49-6082-4faa-9ae7-6d09c57fde50.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z42D60FD6AEDA4EACAF20Z/45/_/1735115507/fc26e8bf-dcc1-4c88-8b5e-c98daca2daf2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z42D60FD6AEDA4EACAF20Z/45/_/1735115508/474c23d2-3753-4402-9172-ae3b7213de82.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z42D60FD6AEDA4EACAF20Z/45/_/1735115567/736172d0-97a8-4e31-b58d-849e937bb713.jpg'], 'currency': 'AED', 'price': 491.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'ZB50FB622E5050DCAC2A3Z', 'name': 'MIRFA Bar Pendant Chain Necklace - Golden ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB50FB622E5050DCAC2A3Z/45/_/1714415405/c5bf6475-6e6d-4217-ac3b-aca727f0b80b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB50FB622E5050DCAC2A3Z/45/_/1714415425/200133e6-f68f-4595-8767-38758183a2d6.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB50FB622E5050DCAC2A3Z/45/_/1714415445/bdb789c4-9159-41d7-9b51-3574bb540c3e.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB50FB622E5050DCAC2A3Z/45/_/1714415455/b32aaa8b-720b-46d6-9ca5-423fa5c252df.jpg'], 'currency': 'AED', 'price': 48.95, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z3A90618EDE9460843C46Z', 'name': 'MissTiara Capital Letter A-Z Initial Chain Necklace For Girls Women Stainless Steel Square Charm A-Z Alphabet Pendant Necklace Good idea for birthday gifts graduation commemorations or classmate gifts ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z3A90618EDE9460843C46Z/45/_/1697134967/9476a7b2-b002-4e46-8de8-d4120daeed51.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z3A90618EDE9460843C46Z/45/_/1697134968/f68c577d-7bb9-4aee-90f8-0e5c593b4f4c.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z3A90618EDE9460843C46Z/45/_/1697134969/8f5a02f5-352c-4466-8769-99ccbe481111.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z3A90618EDE9460843C46Z/45/_/1697134970/b5c63d80-8f30-4c01-b882-0b8132b0186a.jpg'], 'currency': 'AED', 'price': 18.9, 'rating': 4.8}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z632A8C9761D0E064B793Z', 'name': 'AWNL Majestic Eden Necklace Pendant with Green CZ Diamonds ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z632A8C9761D0E064B793Z/45/_/1723536470/f7e3f07c-b6ad-446a-9ad3-af6e5d6fddc5.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z632A8C9761D0E064B793Z/45/_/1730274898/bb7ce0a7-da4f-46c4-89d4-7e8766dc918f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z632A8C9761D0E064B793Z/45/_/1730274899/dea6ef72-e0e8-4647-a6f1-591188e583d2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z632A8C9761D0E064B793Z/45/_/1730274901/d3abdfea-21ea-4ed4-ab16-0ebec0b736fc.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z632A8C9761D0E064B793Z/45/_/1730274982/7505229d-c52d-4142-ac04-9fc1d352f1e0.jpg'], 'currency': 'AED', 'price': 559.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z6677CD8E92AB67D6545AZ', 'name': 'AWNL Crimson Mirage Pendant Necklace With Red CZ Diamond and 925 Silver Gift For Women Wife Girlfriend ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6677CD8E92AB67D6545AZ/45/_/1732003084/a1a73d22-1268-4c1d-9f95-e0563c6b9890.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6677CD8E92AB67D6545AZ/45/_/1732268789/6aed2895-20e5-4089-9098-e1418f42c829.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6677CD8E92AB67D6545AZ/45/_/1732268791/df5fbcc2-30c4-4cee-b523-18fc7cea63d2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6677CD8E92AB67D6545AZ/45/_/1732515297/f6b23251-63b0-42eb-8b6c-ad395f40dd9f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6677CD8E92AB67D6545AZ/45/_/1732515298/e91ac544-393e-4dff-b5cc-482859e0cfd0.jpg'], 'currency': 'AED', 'price': 509.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z6F627064A1EC8DB83FD5Z', 'name': 'CERRUTI 1881 Adriana Gold Plated Crystals Necklace ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6F627064A1EC8DB83FD5Z/45/_/1725610708/6da7c96c-75af-4cc0-a942-a14d195b1d6f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6F627064A1EC8DB83FD5Z/45/_/1725610718/74d29409-2a40-461b-811b-8e1af3cdd540.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6F627064A1EC8DB83FD5Z/45/_/1725610759/61d6fa77-e7a3-4fb3-a23b-f1b0b2993328.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6F627064A1EC8DB83FD5Z/45/_/1725610761/be8a9dd9-bf32-4251-a6ca-051e0d7bb3bf.jpg'], 'currency': 'AED', 'price': 300.0, 'rating': 3.4}]}]
2025-01-09 18:16:08,319 [INFO] app.logs.logger: Received chat_next request for interaction_id: 5d30fcf7-eb60-4648-bbfd-57a52adeda89
2025-01-09 18:16:08,323 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-09 18:16:08,323 [INFO] app.logs.logger: Fetching interaction with ID: 5d30fcf7-eb60-4648-bbfd-57a52adeda89
2025-01-09 18:16:08,325 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 5d30fcf7-eb60-4648-bbfd-57a52adeda89
2025-01-09 18:17:29,337 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-09 18:17:29,352 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:17:29,353 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-09 18:17:29,361 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:54:19,441 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-12 10:54:19,535 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:54:19,535 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-12 10:54:19,579 [INFO] app.logs.logger: Successfully created new chat session with session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:19,709 [INFO] app.logs.logger: Received chat_history request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:19,712 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-12 10:54:19,713 [INFO] app.logs.logger: Fetching interactions for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:19,717 [INFO] app.logs.logger: No interactions found for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0. Returning default greeting.
2025-01-12 10:54:42,432 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:42,442 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:54:42,443 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:42,443 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: what is the best noise cancelling earpods available?
2025-01-12 10:54:42,444 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:42,448 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:42,450 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 10:54:44,393 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['noise cancelling earpods'], 'search_index': 'Electronics'}
2025-01-12 10:54:44,393 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 10:54:44,403 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 10:54:57,910 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 10:54:57,916 [INFO] app.logs.logger: INTERACTION SAVED:7e8ae596-6990-4bea-9b71-82b27f3d7ac0
2025-01-12 10:54:57,916 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 10:54:57,917 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:57,917 [INFO] app.logs.logger: Returning response for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:54:57,917 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('4ad4f31a-7ab5-4f5a-9cbc-07ba17e6b3c2'), 'interaction_id': UUID('7e8ae596-6990-4bea-9b71-82b27f3d7ac0'), 'role': 'assistant', 'createdAt': 1736679297917, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B09LH7B49B', 'name': 'Anker Soundcore Life P3i Hybrid Active Noise Cancelling Bluetooth Earphones, 4 Mics Wireless Earbuds, AI-Enhanced Calls, 10mm Drivers, App, Custom EQ, 36H Playtime, Fast Charging, Bluetooth 5.2', 'images': ['https://m.media-amazon.com/images/I/516zeYYDIlL.jpg'], 'currency': 'AED', 'price': 110.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DFCGV2SG', 'name': 'SoundPEATS Life3 Wireless Earbuds, Bluetooth 5.3 with 10mm Driver, Dual MIC Noise Cancelling Headphones, PeatsAudio APP Control&Multipoint Connection Bluetooth Earphones, 20H Playtime, Game Mode', 'images': ['https://m.media-amazon.com/images/I/51dOSYH0IdL.jpg'], 'currency': 'AED', 'price': 79.0, 'rating': 4.9}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CHX7S6GB', 'name': 'Apple AirPods Pro 2 Wireless Earbuds, Bluetooth Headphones, Active Noise Cancellation, Hearing Aid Feature, Transparency, Personalized Spatial Audio, High-Fidelity Sound, H2 Chip, USB-C Charging', 'images': ['https://m.media-amazon.com/images/I/51HCs2mVKsL.jpg'], 'currency': 'AED', 'price': 739.0, 'rating': 4.5}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0B5TDPP5K', 'name': 'True Wireless Earbuds, Bluetooth Earphones 60H Playback, CVC Noise Cancelling with Wireless Charging Case, in-Ear Stereo Wireless Earphones Built-in Mic, LED Display, IPX7 Waterproof Sport Headphones', 'images': ['https://m.media-amazon.com/images/I/61TX7WRvyWL.jpg'], 'currency': 'AED', 'price': 69.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CRTPF7CZ', 'name': 'soundcore R50i NC by Anker Noise Cancelling Earbuds, Strong and Smart Noise Cancelling, Powerful Bass, 45H Playtime, 2-in-1 Case and Phone Stand, IP54, Wireless Earbuds, Bluetooth 5.4, App Control.', 'images': ['https://m.media-amazon.com/images/I/41Quiz3Dg-L.jpg'], 'currency': 'AED', 'price': 99.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0B1LPNDGF', 'name': 'Soundcore by Anker Space A40 Auto-Adjustable Active Noise Cancelling Wireless Earbuds, Reduce Noise by Up to 98%, 50H Playtime, Hi-Res Sound, Comfortable Fit, App Customization, Wireless Charge', 'images': ['https://m.media-amazon.com/images/I/51LwJKT0SFL.jpg'], 'currency': 'AED', 'price': 178.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09DXTD6T4', 'name': 'soundcore Anker Life A3i Noise Cancelling Wireless Earbuds, Deep Bass, Hybrid ANC Bluetooth Earphones, AI-Enhanced Calls with 4 Mics, 40H Playtime with Fast Charging, Bluetooth 5.2, 22 Custom EQ', 'images': ['https://m.media-amazon.com/images/I/41Pma6h2vnL.jpg'], 'currency': 'AED', 'price': 109.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DPSG8BJC', 'name': 'Active Noise Cancelling Wireless Earbuds, in-Ear Earphones Bluetooth 5.4, Immersive Sound Headphones, 20H Playtime, USB-C Ear Bud, Light-Weight TWS Earphone for iPhone, Android, Sports, Workout, White', 'images': ['https://m.media-amazon.com/images/I/51jxPVUFE9L.jpg'], 'currency': 'AED', 'price': 29.0, 'rating': 5.0}]}, {'type': 'noonProducts', 'id': UUID('f76af024-59ca-4577-b0ff-4145404145f0'), 'interaction_id': UUID('7e8ae596-6990-4bea-9b71-82b27f3d7ac0'), 'role': 'assistant', 'createdAt': 1736679297917, 'products': [{'platform': 'noon', 'country': 'ae', 'asin': 'N53406573A', 'name': 'Soundcore P20i True Wireless Earbuds, 10mm Drivers with Big Bass, 30H Long Playtime, IPX5 Water-Resistant, 2 Mics for AI Clear Calls, 22 Preset EQs, Customization via App Blue ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305447/N53406573A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305447/N53406573A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305447/N53406573A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305447/N53406573A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305447/N53406573A_5.jpg'], 'currency': 'AED', 'price': 79.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'N53406571A', 'name': 'Soundcore P20i Bluetooth Earphones, 10mm Drivers with Big Bass True Wireless Earbuds, 30H Playtime, IPX5, 2 Mics for AI Clear Calls, 22 Preset EQs, Customization via App Black+Gray ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_5.jpg'], 'currency': 'AED', 'price': 99.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70001418V', 'name': 'Soundcore By Anker A25i True Wireless Earbuds, Bluetooth 5.3, App, Customized Sound, 28H Long Playtime, Water-Resistant, 2 Mics For AI Clear Calls, Single Earbud Mode Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70001418V/45/_/1695297963/20ce6973-d935-4947-9ec6-4922d4853245.jpg'], 'currency': 'AED', 'price': 69.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N53432096A', 'name': 'Soundcore Liberty 4 NC Earbuds, 98.5 Percent Noise Reduction, Adaptive Cancelling To Ears And Environment, Hi-Res Sound, 50H Battery, Wireless Charging, Bluetooth 5.3 Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1692982976/N53432096A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692982977/N53432096A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692982977/N53432096A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692982977/N53432096A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692982977/N53432096A_5.jpg'], 'currency': 'AED', 'price': 249.0, 'rating': 4.5}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70126877V', 'name': 'Soundcore P30i by Anker Noise Cancelling Earbuds, Strong and Smart Noise Cancelling, Powerful Bass, 45H Playtime, 2-in-1 Case and Phone Stand, IP54, Wireless Earbuds, Bluetooth 5.4, App Control White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70126877V/45/_/1730789201/3583dbbf-81e2-42cd-9ec4-7c154da6348d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70126877V/45/_/1730789202/a4d05e26-8fc2-459a-a799-b343c17d68b7.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70126877V/45/_/1730789203/ee8ad15e-fa16-4e3d-b691-d1e945175a4f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70126877V/45/_/1730789204/86c42d55-351e-4508-b55c-98516ed47979.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70126877V/45/_/1730789204/e711c0ad-0139-426f-8be2-8b3bcbdba200.jpg'], 'currency': 'AED', 'price': 179.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70022443V', 'name': 'Soundcore Life P2 Mini Earphones, 10mm Drivers With Big Bass Wireless Earbuds, Custom EQ, Bluetooth 5.2, 32H Playtime, USB-C Fast Charging, Tiny Size For Commute, Work Coral Blue ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70022443V/45/_/1699517272/6cbf8002-cdbe-4f8f-8d76-ded2b4e8eaa8.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70022443V/45/_/1699517273/9d73e3a0-45a0-4a12-bd80-0add5da87985.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70022443V/45/_/1699517275/98565ca8-7e12-49d5-8f58-38694671d40a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70022443V/45/_/1699517352/988c09ef-6547-4cbd-9ea9-d15a0b0b8689.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70022443V/45/_/1705310009/e1fbe6f3-35f6-4442-99ba-edae7e5fefdf.jpg'], 'currency': 'AED', 'price': 115.0, 'rating': 4.2}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70086656V', 'name': 'Soundcore A30i Noise Cancelling Earbuds, Lipstick-Shaped Stylish Design, Tiny, Lightweight Comfort, Smart Noise Cancelling, Clear Sound, 24H Playtime, IP54, Wireless Earbuds, Bluetooth 5.4 Blue ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086656V/45/_/1718940784/161cfcc3-0383-4754-97bb-8de37cf90448.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086656V/45/_/1718940784/4079dc1e-3862-460e-ad6e-09cc19d36720.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086656V/45/_/1718940785/22148f1d-82a1-4d02-a3db-096b0c273903.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086656V/45/_/1718940786/eed94eaa-d7c8-4cce-acb0-952b9fa1f911.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086656V/45/_/1718940787/02a6c307-ad9b-40c8-b702-d5a4a0fbc539.jpg'], 'currency': 'AED', 'price': 199.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z61CBB33264205AC4E20BZ', 'name': 'ZIPFORCE ZIPFORCE True Wireless Earbuds, Fully In-Ear Bluetooth 5.3 Headphones 4-Mics ANC + ENC Clear Call, Bluetooth Earbuds Touch Control 40 Playtime, IPX6 Waterproof TWS, Light-Weight Earphones ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z61CBB33264205AC4E20BZ/45/_/1721723832/a3cc29f9-cf71-4a6d-aed7-fcb4d18421da.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z61CBB33264205AC4E20BZ/45/_/1721723914/7bd2aeaa-5411-46ac-8126-e4be2cea29e0.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z61CBB33264205AC4E20BZ/45/_/1721723934/63aab7c0-c459-487a-82ac-43fe124a2e45.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z61CBB33264205AC4E20BZ/45/_/1721724015/11f473e8-726a-4243-8f7d-7723706eff19.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z61CBB33264205AC4E20BZ/45/_/1721724045/198c01c9-ab8c-4c0d-bd6d-90ab19cea3ac.jpg'], 'currency': 'AED', 'price': 95.5, 'rating': 4.1}]}]
2025-01-12 10:54:58,228 [INFO] app.logs.logger: Received chat_next request for interaction_id: 7e8ae596-6990-4bea-9b71-82b27f3d7ac0
2025-01-12 10:54:58,232 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 10:54:58,232 [INFO] app.logs.logger: Fetching interaction with ID: 7e8ae596-6990-4bea-9b71-82b27f3d7ac0
2025-01-12 10:54:58,234 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 7e8ae596-6990-4bea-9b71-82b27f3d7ac0
2025-01-12 10:55:35,002 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,013 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:55:35,014 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,014 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: anything from sony or bose
2025-01-12 10:55:35,014 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,017 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,021 [ERROR] app.logs.logger: Unexpected error in MessageChain: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 300, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 180, in load_session_history
    "id": tool_call['id'],
          ~~~~~~~~~^^^^^^
TypeError: string indices must be integers, not 'str'
2025-01-12 10:55:35,023 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,024 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 10:55:35,145 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,148 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:55:35,148 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,148 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: anything from sony or bose
2025-01-12 10:55:35,148 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,150 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,154 [ERROR] app.logs.logger: Unexpected error in MessageChain: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 300, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 180, in load_session_history
    "id": tool_call['id'],
          ~~~~~~~~~^^^^^^
TypeError: string indices must be integers, not 'str'
2025-01-12 10:55:35,155 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,155 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 10:55:35,309 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,312 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:55:35,313 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,313 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: anything from sony or bose
2025-01-12 10:55:35,313 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,316 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,317 [ERROR] app.logs.logger: Unexpected error in MessageChain: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 300, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 180, in load_session_history
    "id": tool_call['id'],
          ~~~~~~~~~^^^^^^
TypeError: string indices must be integers, not 'str'
2025-01-12 10:55:35,319 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,319 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 10:55:35,469 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,478 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:55:35,479 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,479 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: anything from sony or bose
2025-01-12 10:55:35,479 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,481 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,483 [ERROR] app.logs.logger: Unexpected error in MessageChain: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 300, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 180, in load_session_history
    "id": tool_call['id'],
          ~~~~~~~~~^^^^^^
TypeError: string indices must be integers, not 'str'
2025-01-12 10:55:35,483 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,484 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 10:55:35,627 [INFO] app.logs.logger: Received chat request for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,630 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 10:55:35,630 [INFO] app.logs.logger: Processing message for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,631 [INFO] app.logs.logger: Starting MessageChain for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0 with message: anything from sony or bose
2025-01-12 10:55:35,631 [INFO] app.logs.logger: Initializing ConversationState for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,632 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,634 [ERROR] app.logs.logger: Unexpected error in MessageChain: string indices must be integers, not 'str'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 300, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 180, in load_session_history
    "id": tool_call['id'],
          ~~~~~~~~~^^^^^^
TypeError: string indices must be integers, not 'str'
2025-01-12 10:55:35,634 [INFO] app.logs.logger: Formatting app reply for session_id: 11512a40-5651-4709-ad49-8e4b334c07b0
2025-01-12 10:55:35,635 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:00:08,823 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-12 11:00:08,896 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:00:08,896 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:00:08,902 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:00:11,990 [INFO] app.logs.logger: Received chat_history request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:11,996 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-12 11:00:11,996 [INFO] app.logs.logger: Fetching interactions for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:12,017 [INFO] app.logs.logger: No interactions found for session_id: 99f902ac-3d62-431c-a90b-13a22f966756. Returning default greeting.
2025-01-12 11:00:25,378 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:25,391 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:00:25,391 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:25,391 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: what is the best noise canccelling earpods?
2025-01-12 11:00:25,395 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:25,401 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:25,403 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:00:26,120 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['noise cancelling earpods', 'noise cancelling earbuds'], 'search_index': 'electronics'}
2025-01-12 11:00:26,122 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 11:00:26,137 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 11:00:40,266 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 11:00:40,277 [INFO] app.logs.logger: INTERACTION SAVED:9db1cf26-c539-4150-94c4-553698f7420f
2025-01-12 11:00:40,277 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 11:00:40,278 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:40,278 [INFO] app.logs.logger: Returning response for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:00:40,279 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('fa8a869b-5f55-476c-b197-c74c975dc669'), 'interaction_id': UUID('9db1cf26-c539-4150-94c4-553698f7420f'), 'role': 'assistant', 'createdAt': 1736679640278, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B09LH7B49B', 'name': 'Anker Soundcore Life P3i Hybrid Active Noise Cancelling Bluetooth Earphones, 4 Mics Wireless Earbuds, AI-Enhanced Calls, 10mm Drivers, App, Custom EQ, 36H Playtime, Fast Charging, Bluetooth 5.2', 'images': ['https://m.media-amazon.com/images/I/516zeYYDIlL.jpg'], 'currency': 'AED', 'price': 110.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CRTPF7CZ', 'name': 'soundcore R50i NC by Anker Noise Cancelling Earbuds, Strong and Smart Noise Cancelling, Powerful Bass, 45H Playtime, 2-in-1 Case and Phone Stand, IP54, Wireless Earbuds, Bluetooth 5.4, App Control.', 'images': ['https://m.media-amazon.com/images/I/41Quiz3Dg-L.jpg'], 'currency': 'AED', 'price': 99.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0D9YYQ7X9', 'name': 'Xiaomi Redmi Buds 6 Lite â€“ Wireless Earbuds, Noise Cancelling, Lightweight, Up to 36 Hours of Runtime, Bluetooth 5.3, Black (ES Version)', 'images': ['https://m.media-amazon.com/images/I/51cLxd4S4JL.jpg'], 'currency': 'AED', 'price': 67.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DPSG8BJC', 'name': 'Active Noise Cancelling Wireless Earbuds, in-Ear Earphones Bluetooth 5.4, Immersive Sound Headphones, 20H Playtime, USB-C Ear Bud, Light-Weight TWS Earphone for iPhone, Android, Sports, Workout, White', 'images': ['https://m.media-amazon.com/images/I/51jxPVUFE9L.jpg'], 'currency': 'AED', 'price': 29.0, 'rating': 5.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09DXTD6T4', 'name': 'soundcore Anker Life A3i Noise Cancelling Wireless Earbuds, Deep Bass, Hybrid ANC Bluetooth Earphones, AI-Enhanced Calls with 4 Mics, 40H Playtime with Fast Charging, Bluetooth 5.2, 22 Custom EQ', 'images': ['https://m.media-amazon.com/images/I/41Pma6h2vnL.jpg'], 'currency': 'AED', 'price': 109.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0B1LPNDGF', 'name': 'Soundcore by Anker Space A40 Auto-Adjustable Active Noise Cancelling Wireless Earbuds, Reduce Noise by Up to 98%, 50H Playtime, Hi-Res Sound, Comfortable Fit, App Customization, Wireless Charge', 'images': ['https://m.media-amazon.com/images/I/51LwJKT0SFL.jpg'], 'currency': 'AED', 'price': 178.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0BZ3KGJWR', 'name': 'QCY HT07 Arc Buds Bluetooth Earbuds, Active Noise Cancelling Wireless Earphones, HiFi Stereo in-Ear Headphones, 6 Mics, AI-Enhanced Calls, 30H Playtime', 'images': ['https://m.media-amazon.com/images/I/5144vQgvLVL.jpg'], 'currency': 'AED', 'price': 84.0, 'rating': 4.5}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DL3DTB22', 'name': 'New Wireless Earpod || Noise cancelling earbuds 3rd generation || Lighting charging case || || Android and PC use.', 'images': ['https://m.media-amazon.com/images/I/51sK0LPSCYL.jpg'], 'currency': 'AED', 'price': 28.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0BYPFNW6T', 'name': 'Sony WF-C700N Truly Wireless Noise Canceling in-Ear Bluetooth Earbud Headphones with Mic and IPX4 Water Resistance, Black, one size', 'images': ['https://m.media-amazon.com/images/I/41l+GRy9UsL.jpg'], 'currency': 'AED', 'price': 259.0, 'rating': 4.0}]}]
2025-01-12 11:00:40,573 [INFO] app.logs.logger: Received chat_next request for interaction_id: 9db1cf26-c539-4150-94c4-553698f7420f
2025-01-12 11:00:40,578 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:00:40,578 [INFO] app.logs.logger: Fetching interaction with ID: 9db1cf26-c539-4150-94c4-553698f7420f
2025-01-12 11:00:40,581 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 9db1cf26-c539-4150-94c4-553698f7420f
2025-01-12 11:01:01,829 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:01,843 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:01:01,843 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:01,843 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: anything from sony or bose?
2025-01-12 11:01:01,844 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:01,849 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:01,853 [ERROR] app.logs.logger: Unexpected error in MessageChain: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 303, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 177, in load_session_history
    tool_call = json.loads(tool_call)
                ^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-01-12 11:01:01,856 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:01,856 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:01:02,022 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,027 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:01:02,027 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,027 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: anything from sony or bose?
2025-01-12 11:01:02,028 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,030 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,031 [ERROR] app.logs.logger: Unexpected error in MessageChain: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 303, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 177, in load_session_history
    tool_call = json.loads(tool_call)
                ^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-01-12 11:01:02,032 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,032 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:01:02,182 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,185 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:01:02,185 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,186 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: anything from sony or bose?
2025-01-12 11:01:02,186 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,188 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,189 [ERROR] app.logs.logger: Unexpected error in MessageChain: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 303, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 177, in load_session_history
    tool_call = json.loads(tool_call)
                ^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-01-12 11:01:02,191 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,191 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:01:02,350 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,364 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:01:02,364 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,364 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: anything from sony or bose?
2025-01-12 11:01:02,365 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,366 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,368 [ERROR] app.logs.logger: Unexpected error in MessageChain: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 303, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 177, in load_session_history
    tool_call = json.loads(tool_call)
                ^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-01-12 11:01:02,369 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,369 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:01:02,492 [INFO] app.logs.logger: Received chat request for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,495 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:01:02,496 [INFO] app.logs.logger: Processing message for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,496 [INFO] app.logs.logger: Starting MessageChain for session_id: 99f902ac-3d62-431c-a90b-13a22f966756 with message: anything from sony or bose?
2025-01-12 11:01:02,496 [INFO] app.logs.logger: Initializing ConversationState for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,499 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,500 [ERROR] app.logs.logger: Unexpected error in MessageChain: Expecting value: line 1 column 1 (char 0)
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 303, in MessageChain
    state = await interaction_manager.load_session_history(state)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 177, in load_session_history
    tool_call = json.loads(tool_call)
                ^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/__init__.py", line 346, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 337, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/miniconda3/lib/python3.11/json/decoder.py", line 355, in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
2025-01-12 11:01:02,501 [INFO] app.logs.logger: Formatting app reply for session_id: 99f902ac-3d62-431c-a90b-13a22f966756
2025-01-12 11:01:02,501 [ERROR] app.logs.logger: Unexpected error in chat_response: 'amazonProducts'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 153, in chat_response
    response_formatted = await formatAppReply(interaction)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/utils/appUtils.py", line 64, in formatAppReply
    if response['amazonProducts']:
       ~~~~~~~~^^^^^^^^^^^^^^^^^^
KeyError: 'amazonProducts'
2025-01-12 11:08:41,740 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-12 11:08:41,827 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:08:41,827 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-12 11:08:41,843 [INFO] app.logs.logger: Successfully created new chat session with session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:41,979 [INFO] app.logs.logger: Received chat_history request for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:41,984 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-12 11:08:41,985 [INFO] app.logs.logger: Fetching interactions for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:42,010 [INFO] app.logs.logger: No interactions found for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e. Returning default greeting.
2025-01-12 11:08:50,814 [INFO] app.logs.logger: Received chat request for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:50,828 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:08:50,829 [INFO] app.logs.logger: Processing message for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:50,829 [INFO] app.logs.logger: Starting MessageChain for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e with message: sony earpods
2025-01-12 11:08:50,833 [INFO] app.logs.logger: Initializing ConversationState for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:50,840 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:08:50,843 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:08:51,615 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['sony', 'earpods'], 'search_index': 'Electronics'}
2025-01-12 11:08:51,623 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 11:08:51,635 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 11:09:05,619 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 11:09:05,629 [INFO] app.logs.logger: INTERACTION SAVED:929672c9-690d-4860-ac1a-4420dbfcffee
2025-01-12 11:09:05,630 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 11:09:05,630 [INFO] app.logs.logger: Formatting app reply for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:05,630 [INFO] app.logs.logger: Returning response for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:05,631 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('66ec40f1-ed38-4e8d-9828-81f5c421d668'), 'interaction_id': UUID('929672c9-690d-4860-ac1a-4420dbfcffee'), 'role': 'assistant', 'createdAt': 1736680145630, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B0BYPFNW6T', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/41l+GRy9UsL.jpg'], 'currency': 'AED', 'price': 259.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0D9R4GYTN', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/51B6+Iyd3ML.jpg'], 'currency': 'AED', 'price': 179.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09FKGJ1CB', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/4139iV1HwAL.jpg'], 'currency': 'AED', 'price': 175.0, 'rating': 3.8}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0BSGQL41X', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/41fn3hNjnRL.jpg'], 'currency': 'AED', 'price': 145.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09HH2VVL4', 'name': 'JBL', 'images': ['https://m.media-amazon.com/images/I/51YksBB9vCL.jpg'], 'currency': 'AED', 'price': 113.0, 'rating': 3.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09CHJDZYL', 'name': 'Marshall', 'images': ['https://m.media-amazon.com/images/I/71coMXf8VlL.jpg'], 'currency': 'AED', 'price': 309.0, 'rating': 3.7}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09YLFHFDW', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/41d2o4QXPfL.jpg'], 'currency': 'AED', 'price': 62.0, 'rating': 3.8}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09YLCXLKY', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/51r5oHmkC+L.jpg'], 'currency': 'AED', 'price': 85.0, 'rating': 3.9}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CYL14LBT', 'name': 'Sony', 'images': ['https://m.media-amazon.com/images/I/51hzvWaLUqL.jpg'], 'currency': 'AED', 'price': 575.0, 'rating': 4.2}]}, {'type': 'noonProducts', 'id': UUID('d8fb9286-eccf-4ef3-a32f-26200132937f'), 'interaction_id': UUID('929672c9-690d-4860-ac1a-4420dbfcffee'), 'role': 'assistant', 'createdAt': 1736680145630, 'products': [{'platform': 'noon', 'country': 'ae', 'asin': 'ZC122E0AC8180A634D99EZ', 'name': 'glassology GTA2 Truly Wireless Earbuds Active Noise Cancelling Thumping Bass Multi Mode Upto 30H Playtime Wireless Magsafe Charging Customized Sound Gaming Mode ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400197/4af77b1c-d5a5-4bec-90a1-9e9676de105d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400247/499b31e3-9535-43b3-ab77-597a87d9bf1b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400278/c2e67512-13e4-43f9-a813-3b258767c442.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400279/222fc5d6-e0be-4434-879b-2bf43923c5b3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400280/6c463ffe-b39b-4cc8-b413-36bfe4ac59dd.jpg'], 'currency': 'AED', 'price': 125.0, 'rating': 4.1}, {'platform': 'noon', 'country': 'ae', 'asin': 'N53406571A', 'name': 'Soundcore P20i Bluetooth Earphones, 10mm Drivers with Big Bass True Wireless Earbuds, 30H Playtime, IPX5, 2 Mics for AI Clear Calls, 22 Preset EQs, Customization via App Black+Gray ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_5.jpg'], 'currency': 'AED', 'price': 99.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z1C3BBFE35332D0C01077Z', 'name': 'Max & Max Airbuds Lite Noise Cancellation Wireless Magsafe Charging ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1718285624/29edbd49-b255-4905-8262-f1a0e6c1def4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719905552/5d478e2c-8bde-48bd-93fa-e2ab3885a63d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719905555/e347983c-6e1b-40f2-bc54-4a377fc0ae53.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719991013/33b9c6b9-a39b-4509-83fc-e0ed78af8f60.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719991013/66f42991-ff08-4403-a1ff-5752d9bdb91d.jpg'], 'currency': 'AED', 'price': 110.0, 'rating': 4.0}, {'platform': 'noon', 'country': 'ae', 'asin': 'N53405487A', 'name': 'Sony WF-C700N/BZ Truly Wireless Headphones Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1684210441/N53405487A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684210441/N53405487A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684210441/N53405487A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684210442/N53405487A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684210442/N53405487A_5.jpg'], 'currency': 'AED', 'price': 259.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N53423373A', 'name': 'Sony WF1000XM5 Truewireless Noise Cancelling Earbuds Black ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'AED', 'price': 709.0, 'rating': 4.1}, {'platform': 'noon', 'country': 'ae', 'asin': 'ZECC89FDB350D0A3428D0Z', 'name': 'Generic TWS Wireless In-Ear Earbuds With Charging Case ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'AED', 'price': 37.05, 'rating': 3.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70001418V', 'name': 'Soundcore By Anker A25i True Wireless Earbuds, Bluetooth 5.3, App, Customized Sound, 28H Long Playtime, Water-Resistant, 2 Mics For AI Clear Calls, Single Earbud Mode Black ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'AED', 'price': 69.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70086652V', 'name': 'Soundcore A30i Noise Cancelling Earbuds, Lipstick-Shaped Stylish Design, Tiny, Lightweight Comfort, Smart Noise Cancelling, Clear Sound, 24H Playtime, IP54, Wireless Earbuds, Bluetooth 5.4 Black ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'AED', 'price': 199.0, 'rating': 4.3}]}]
2025-01-12 11:09:05,886 [INFO] app.logs.logger: Received chat_next request for interaction_id: 929672c9-690d-4860-ac1a-4420dbfcffee
2025-01-12 11:09:05,895 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:05,896 [INFO] app.logs.logger: Fetching interaction with ID: 929672c9-690d-4860-ac1a-4420dbfcffee
2025-01-12 11:09:05,898 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 929672c9-690d-4860-ac1a-4420dbfcffee
2025-01-12 11:09:23,784 [INFO] app.logs.logger: Received chat request for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:23,799 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:09:23,800 [INFO] app.logs.logger: Processing message for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:23,800 [INFO] app.logs.logger: Starting MessageChain for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e with message: anything from bose?
2025-01-12 11:09:23,801 [INFO] app.logs.logger: Initializing ConversationState for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:23,806 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:23,810 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:09:24,701 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['bose', 'earpods'], 'search_index': 'Electronics'}
2025-01-12 11:09:24,701 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 11:09:24,703 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 11:09:37,640 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 11:09:37,647 [INFO] app.logs.logger: INTERACTION SAVED:0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:37,647 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 11:09:37,648 [INFO] app.logs.logger: Formatting app reply for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:37,648 [INFO] app.logs.logger: Returning response for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:09:37,648 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('f2e38629-c88b-4955-bd22-dba29dd3ff53'), 'interaction_id': UUID('0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81'), 'role': 'assistant', 'createdAt': 1736680177648, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B0D8BZDPXB', 'name': 'New Bose QuietComfort Wireless Noise Cancelling Earbuds, Lifestyle Bluetooth Earbuds with Active Noise Cancellation, Up to 8.5 Hours of Battery Life, Black', 'images': ['https://m.media-amazon.com/images/I/51-FK1DFxBL.jpg'], 'currency': 'AED', 'price': 549.0, 'rating': 4.1}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CD2FSRDD', 'name': 'Bose', 'images': ['https://m.media-amazon.com/images/I/512mPubhJdL.jpg'], 'currency': 'AED', 'price': 948.0, 'rating': 3.8}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CCZ1L489', 'name': 'Bose', 'images': ['https://m.media-amazon.com/images/I/51ZR4lyxBHL.jpg'], 'currency': 'AED', 'price': 1289.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CCZ26B5V', 'name': 'New Bose QuietComfort Wireless Noise Cancelling Headphones, Bluetooth Over Ear Headphones with Up To 24 Hours of Battery Life, Black 2023', 'images': ['https://m.media-amazon.com/images/I/51QeS0jkx-L.jpg'], 'currency': 'AED', 'price': 799.0, 'rating': 4.5}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CXDDWRTQ', 'name': 'CMF BY NOTHING', 'images': ['https://m.media-amazon.com/images/I/51wPkNzqyKL.jpg'], 'currency': 'AED', 'price': 125.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09HGGV5R5', 'name': 'JBL', 'images': ['https://m.media-amazon.com/images/I/51Z7AxeZKKL.jpg'], 'currency': 'AED', 'price': 113.0, 'rating': 3.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B09DD1ZX1Q', 'name': 'Jabra', 'images': ['https://m.media-amazon.com/images/I/51dxQxlMy+L.jpg'], 'currency': 'AED', 'price': 249.0, 'rating': 3.8}]}, {'type': 'noonProducts', 'id': UUID('070d99d8-2a1f-48f6-9ee9-bc32ad468e7e'), 'interaction_id': UUID('0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81'), 'role': 'assistant', 'createdAt': 1736680177648, 'products': [{'platform': 'noon', 'country': 'ae', 'asin': 'N53406571A', 'name': 'Soundcore P20i Bluetooth Earphones, 10mm Drivers with Big Bass True Wireless Earbuds, 30H Playtime, IPX5, 2 Mics for AI Clear Calls, 22 Preset EQs, Customization via App Black+Gray ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1684305500/N53406571A_5.jpg'], 'currency': 'AED', 'price': 99.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'ae', 'asin': 'ZC122E0AC8180A634D99EZ', 'name': 'glassology GTA2 Truly Wireless Earbuds Active Noise Cancelling Thumping Bass Multi Mode Upto 30H Playtime Wireless Magsafe Charging Customized Sound Gaming Mode ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400197/4af77b1c-d5a5-4bec-90a1-9e9676de105d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400247/499b31e3-9535-43b3-ab77-597a87d9bf1b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400278/c2e67512-13e4-43f9-a813-3b258767c442.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400279/222fc5d6-e0be-4434-879b-2bf43923c5b3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZC122E0AC8180A634D99EZ/45/_/1736400280/6c463ffe-b39b-4cc8-b413-36bfe4ac59dd.jpg'], 'currency': 'AED', 'price': 125.0, 'rating': 4.1}, {'platform': 'noon', 'country': 'ae', 'asin': 'Z1C3BBFE35332D0C01077Z', 'name': 'Max & Max Airbuds Lite Noise Cancellation Wireless Magsafe Charging ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1718285624/29edbd49-b255-4905-8262-f1a0e6c1def4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719905552/5d478e2c-8bde-48bd-93fa-e2ab3885a63d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719905555/e347983c-6e1b-40f2-bc54-4a377fc0ae53.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719991013/33b9c6b9-a39b-4509-83fc-e0ed78af8f60.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1C3BBFE35332D0C01077Z/45/_/1719991013/66f42991-ff08-4403-a1ff-5752d9bdb91d.jpg'], 'currency': 'AED', 'price': 110.0, 'rating': 4.0}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70008886V', 'name': 'BOSE QuietComfort\xa0 Ultra\xa0Wireless\xa0Noise\xa0Cancelling EarBuds Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70008886V/45/_/1695972821/50b0c1fe-1f95-401b-a5ed-98ee573ce88a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70008886V/45/_/1695972822/310d69f1-e6ee-438f-a494-24f5c2acb434.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70008886V/45/_/1695972823/d133c211-5e4d-44c5-97e1-7d090758fe55.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70008886V/45/_/1695972824/1076e252-7698-40d2-a917-e2659a4aa412.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70008886V/45/_/1695972897/efc497b0-158c-4d9c-9366-35984b1e98f0.jpg'], 'currency': 'AED', 'price': 948.95, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70111992V', 'name': 'BOSE QuietComfort Wireless Noise Cancelling Earbuds, Lifestyle Bluetooth Earbuds with Active Noise Cancellation, Up to 8.5 Hours of Battery Life Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70111992V/45/_/1726552868/54f2c8ba-b429-4014-8513-f7f2b5db5963.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70111992V/45/_/1726552869/1447e126-934b-4b9f-8a12-4c5e715e6156.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70111992V/45/_/1726552869/c2373f53-6fa4-48ee-81ee-138bb0ce4e59.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70111992V/45/_/1726552870/d246c2f2-53ea-4f81-96bd-e2b8dffcf0ba.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70111992V/45/_/1726552871/81387695-2a3c-4b50-be8c-407e8620aec4.jpg'], 'currency': 'AED', 'price': 549.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'ZECC89FDB350D0A3428D0Z', 'name': 'Generic TWS Wireless In-Ear Earbuds With Charging Case ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZECC89FDB350D0A3428D0Z/45/_/1715103661/f7f6ebce-b346-44a1-8ef3-91c2d53f7408.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZECC89FDB350D0A3428D0Z/45/_/1715103671/53e44039-5ba5-48da-82ff-aba1bd877b55.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZECC89FDB350D0A3428D0Z/45/_/1715103681/66c31849-014c-4bc7-9a06-74ffea92d805.jpg'], 'currency': 'AED', 'price': 37.05, 'rating': 3.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70001418V', 'name': 'Soundcore By Anker A25i True Wireless Earbuds, Bluetooth 5.3, App, Customized Sound, 28H Long Playtime, Water-Resistant, 2 Mics For AI Clear Calls, Single Earbud Mode Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70001418V/45/_/1695297963/20ce6973-d935-4947-9ec6-4922d4853245.jpg'], 'currency': 'AED', 'price': 69.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'ae', 'asin': 'N70086652V', 'name': 'Soundcore A30i Noise Cancelling Earbuds, Lipstick-Shaped Stylish Design, Tiny, Lightweight Comfort, Smart Noise Cancelling, Clear Sound, 24H Playtime, IP54, Wireless Earbuds, Bluetooth 5.4 Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086652V/45/_/1718940775/b8bb4b84-393e-4120-8b37-e4112dee0dc3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086652V/45/_/1718940776/1dbab00e-87ca-4e05-8453-0b91f7b8499b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086652V/45/_/1718940776/671284da-c2ee-4588-beb6-7d0b4fa5038a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086652V/45/_/1718940778/fef06592-36f1-4702-a89e-0b6410ef7e7b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70086652V/45/_/1718940779/7fa1c514-cdcd-4fa3-bc63-8d35f8239487.jpg'], 'currency': 'AED', 'price': 199.0, 'rating': 4.3}]}]
2025-01-12 11:09:37,934 [INFO] app.logs.logger: Received chat_next request for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:37,940 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:37,940 [INFO] app.logs.logger: Fetching interaction with ID: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:37,942 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:37,942 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:09:38,090 [INFO] app.logs.logger: Received chat_next request for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,093 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:38,094 [INFO] app.logs.logger: Fetching interaction with ID: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,095 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,095 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:09:38,203 [INFO] app.logs.logger: Received chat_next request for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,206 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:38,206 [INFO] app.logs.logger: Fetching interaction with ID: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,208 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,208 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:09:38,331 [INFO] app.logs.logger: Received chat_next request for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,334 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:38,335 [INFO] app.logs.logger: Fetching interaction with ID: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,337 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,337 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:09:38,492 [INFO] app.logs.logger: Received chat_next request for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,495 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:09:38,495 [INFO] app.logs.logger: Fetching interaction with ID: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,496 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 0b83046b-fb0d-4a00-a5b1-c4c9cffa4e81
2025-01-12 11:09:38,497 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:10:37,902 [INFO] app.logs.logger: Received chat request for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:37,999 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:10:38,000 [INFO] app.logs.logger: Processing message for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:38,001 [INFO] app.logs.logger: Starting MessageChain for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e with message: how do you compare the sony to the bose?
2025-01-12 11:10:38,001 [INFO] app.logs.logger: Initializing ConversationState for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:38,009 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:38,016 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:10:43,676 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-12 11:10:43,686 [INFO] app.logs.logger: INTERACTION SAVED:44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:43,686 [INFO] app.logs.logger: Formatting app reply for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:43,686 [INFO] app.logs.logger: Returning response for session_id: fbf4cb8f-bba9-47ca-9afa-80f983e8f63e
2025-01-12 11:10:43,687 [INFO] app.logs.logger: Response:
[{'type': 'text', 'id': UUID('c91269f7-7086-424f-88fd-b0a19b9c1e32'), 'interaction_id': UUID('44e055ae-dd14-4426-ab50-ef98883a8124'), 'role': 'assistant', 'createdAt': 1736680243686, 'text': 'Ah, the classic showdown: Sony vs. Bose! Letâ€™s break it down like a dance-off, shall we? ðŸ’ƒðŸŽ¶\n\n### Sony Earpods:\n1. **Sound Quality:** Sony is known for a punchy bass and clear highs. Perfect for those who love to feel the beat!\n2. **Noise Cancellation:** They offer decent noise cancellation, especially in their premium models like the WF-1000XM5. Itâ€™s like putting on your "do not disturb" sign!\n3. **Battery Life:** Sony earpods typically offer good battery life, often around 8-10 hours on a single charge, with charging cases that extend playtime.\n4. **Price Range:** Generally, they offer a wide range from budget to premium, making them accessible for many wallets.\n5. **Design:** Sleek and modern, but not always as ergonomic as Bose.\n\n### Bose Earpods:\n1. **Sound Quality:** Bose is renowned for balanced sound and superior clarity. Theyâ€™re like the refined wine of audio â€“ smooth and sophisticated!\n2. **Noise Cancellation:** Top-notch! Bose leads the pack with some of the best noise-cancelling technology available. You might forget you\'re on a crowded bus!\n3. **Battery Life:** Similar to Sony, but often around 8-8.5 hours, which is still solid. \n4. **Price Range:** Bose tends to be on the pricier side, especially for their premium models. But hey, you get what you pay for!\n5. **Design:** Known for their comfort and fit, making them ideal for long listening sessions without those pesky earaches.\n\n### Conclusion:\n- **Choose Sony** if youâ€™re looking for that deep bass experience and a broader price range.\n- **Choose Bose** if you prioritize comfort and exceptional noise cancellation in a sleek design.\n\nBoth brands are stellar, so it really boils down to your personal preferences! Now, which side are you leaning towards? ðŸ¤”ðŸŽ§'}]
2025-01-12 11:10:43,923 [INFO] app.logs.logger: Received chat_next request for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:43,927 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:10:43,928 [INFO] app.logs.logger: Fetching interaction with ID: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:43,929 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:43,929 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:10:44,052 [INFO] app.logs.logger: Received chat_next request for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,056 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:10:44,056 [INFO] app.logs.logger: Fetching interaction with ID: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,057 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,058 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:10:44,168 [INFO] app.logs.logger: Received chat_next request for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,171 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:10:44,171 [INFO] app.logs.logger: Fetching interaction with ID: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,173 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,173 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:10:44,293 [INFO] app.logs.logger: Received chat_next request for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,481 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:10:44,481 [INFO] app.logs.logger: Fetching interaction with ID: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,483 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,483 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:10:44,622 [INFO] app.logs.logger: Received chat_next request for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,625 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:10:44,626 [INFO] app.logs.logger: Fetching interaction with ID: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,627 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 44e055ae-dd14-4426-ab50-ef98883a8124
2025-01-12 11:10:44,627 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-12 11:19:42,361 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-12 11:19:42,373 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:19:42,373 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-12 11:19:42,380 [INFO] app.logs.logger: Successfully created new chat session with session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:42,518 [INFO] app.logs.logger: Received chat_history request for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:42,521 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-12 11:19:42,521 [INFO] app.logs.logger: Fetching interactions for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:42,523 [INFO] app.logs.logger: No interactions found for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e. Returning default greeting.
2025-01-12 11:19:51,841 [INFO] app.logs.logger: Received chat request for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:51,851 [INFO] app.logs.logger: User authenticated successfully: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:19:51,852 [INFO] app.logs.logger: Processing message for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:51,853 [INFO] app.logs.logger: Starting MessageChain for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e with message: how much is the new apple earpods
2025-01-12 11:19:51,857 [INFO] app.logs.logger: Initializing ConversationState for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:51,861 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59, country: ae, session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:19:51,863 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:19:53,029 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['Apple AirPods'], 'search_index': 'Electronics'}
2025-01-12 11:19:53,030 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 11:19:53,038 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 11:20:02,626 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 11:20:02,635 [INFO] app.logs.logger: INTERACTION SAVED:2e7d53ab-181e-46be-9e21-a6157d606143
2025-01-12 11:20:02,635 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 11:20:02,636 [INFO] app.logs.logger: Formatting app reply for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:20:02,637 [INFO] app.logs.logger: Returning response for session_id: 267b1f6f-393d-4b56-b9c7-0eee91e63e7e
2025-01-12 11:20:02,637 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('52c13f78-1fd4-4026-b00f-ee2295e4da82'), 'interaction_id': UUID('2e7d53ab-181e-46be-9e21-a6157d606143'), 'role': 'assistant', 'createdAt': 1736680802636, 'products': [{'platform': 'amazon', 'country': 'ae', 'asin': 'B0DGHYPFGK', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/61DvMw16ITL.jpg'], 'currency': 'AED', 'price': 499.0, 'rating': 4.0}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CHX7S6GB', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/51HCs2mVKsL.jpg'], 'currency': 'AED', 'price': 739.0, 'rating': 4.5}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DD413Q9J', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/31F-shG0yAL.jpg'], 'currency': 'AED', 'price': 68.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0BDKB96DD', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/617w+6gZZ5L.jpg'], 'currency': 'AED', 'price': 629.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CQ2W9DVV', 'name': 'Apple Airpods Pro 1st Generation | MagSafe Charging Case | ctive Noise Cancellation | White | Wireless | MLWK3ZM/A (Renewed)', 'images': ['https://m.media-amazon.com/images/I/51qpFiz+5eL.jpg'], 'currency': 'AED', 'price': 557.0, 'rating': 2.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CQ2S9GYJ', 'name': 'Apple AirPods (3rd generation), Wireless (Renewed)', 'images': ['https://m.media-amazon.com/images/I/612kZ3wWQ3L.jpg'], 'currency': 'AED', 'price': 529.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0DNW4B441', 'name': 'Wireless Earbuds, Bluetooth Headphones, with Active Noise Cancellation, Adaptive Audio, Transparency Mode, Personalized Spatial Audio, Charging Case, Wireless Charging', 'images': ['https://m.media-amazon.com/images/I/41rkCAYw93L.jpg'], 'currency': 'AED', 'price': 59.0, 'rating': 4.6}, {'platform': 'amazon', 'country': 'ae', 'asin': 'B0CWVTPS7N', 'name': 'Earbuds-1 (3rd generation) with Lightning Charging Case, Wireless', 'images': ['https://m.media-amazon.com/images/I/518BjBrgj1L.jpg'], 'currency': 'AED', 'price': 69.0, 'rating': 2.7}]}]
2025-01-12 11:20:02,950 [INFO] app.logs.logger: Received chat_next request for interaction_id: 2e7d53ab-181e-46be-9e21-a6157d606143
2025-01-12 11:20:02,955 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, country=ae
2025-01-12 11:20:02,956 [INFO] app.logs.logger: Fetching interaction with ID: 2e7d53ab-181e-46be-9e21-a6157d606143
2025-01-12 11:20:02,957 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 2e7d53ab-181e-46be-9e21-a6157d606143
2025-01-12 11:25:42,147 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-12 11:25:42,159 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:25:42,160 [INFO] app.logs.logger: Fetching chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:25:42,169 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-12 11:27:29,664 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-12 11:27:29,667 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 11:27:29,668 [INFO] app.logs.logger: Creating a new chat session for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05 with title: New Session
2025-01-12 11:27:29,675 [INFO] app.logs.logger: Successfully created new chat session with session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:29,826 [INFO] app.logs.logger: Received chat_history request for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:29,831 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-12 11:27:29,831 [INFO] app.logs.logger: Fetching interactions for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:29,834 [INFO] app.logs.logger: No interactions found for session_id: 29b64579-b639-4312-8f04-daab5bc49749. Returning default greeting.
2025-01-12 11:27:39,189 [INFO] app.logs.logger: Received chat request for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:39,200 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 11:27:39,201 [INFO] app.logs.logger: Processing message for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:39,201 [INFO] app.logs.logger: Starting MessageChain for session_id: 29b64579-b639-4312-8f04-daab5bc49749 with message: apple airpods
2025-01-12 11:27:39,201 [INFO] app.logs.logger: Initializing ConversationState for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:39,204 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:39,206 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 11:27:40,155 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['apple', 'airpods'], 'search_index': 'Electronics'}
2025-01-12 11:27:40,156 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 11:27:40,163 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 11:27:54,696 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 11:27:54,703 [INFO] app.logs.logger: INTERACTION SAVED:6b46aa0e-b110-428e-b4df-74e92af9d47c
2025-01-12 11:27:54,704 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 11:27:54,704 [INFO] app.logs.logger: Formatting app reply for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:54,705 [INFO] app.logs.logger: Returning response for session_id: 29b64579-b639-4312-8f04-daab5bc49749
2025-01-12 11:27:54,705 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('f095b0e2-88ef-4b30-8aa9-50f6ffbb955c'), 'interaction_id': UUID('6b46aa0e-b110-428e-b4df-74e92af9d47c'), 'role': 'assistant', 'createdAt': 1736681274704, 'products': [{'platform': 'amazon', 'country': 'eg', 'asin': 'B07PSZ8395', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/41g4Idd4y9L.jpg'], 'currency': 'EGP', 'price': 6767.0, 'rating': 4.6}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DGJ7M995', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/61k6sJaXIQL.jpg'], 'currency': 'EGP', 'price': 9969.0, 'rating': 4.1}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CHWRXH8B', 'name': 'Apple', 'images': ['https://m.media-amazon.com/images/I/51NRGHU2NoL.jpg'], 'currency': 'EGP', 'price': 11658.0, 'rating': 4.7}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CNL3993S', 'name': 'AirPods Pro 2 [ US ] with Wireless Charging Case, Noise Cancelling, Compatible with All Phones, White, Wireless, in Ear', 'images': ['https://m.media-amazon.com/images/I/51Vfn+c-oSL.jpg'], 'currency': 'EGP', 'price': 396.0, 'rating': 2.9}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CXN9PLR1', 'name': 'New AirPods (3rd Generation)', 'images': ['https://m.media-amazon.com/images/I/41DkedEmQFL.jpg'], 'currency': 'EGP', 'price': 372.0, 'rating': 3.1}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CHX7S6GB', 'name': '2023 AirPods Pro (2nd generation) with MagSafe Case (USBâ€‘C)', 'images': ['https://m.media-amazon.com/images/I/51I8DPFtIJL.jpg'], 'currency': 'EGP', 'price': 11658.0, 'rating': 4.5}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CVVBP6R8', 'name': 'AirPods Pro 2 Plus Bluetooth Headset with Active Noise Cancelling Wireless Charging Case (White, True Wireless) in Ear', 'images': ['https://m.media-amazon.com/images/I/51Fhrkb6TmL.jpg'], 'currency': 'EGP', 'price': 426.0, 'rating': 3.2}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B09VPRD1ST', 'name': 'Pro Earphones with Wireless Charging Case, Active Noise Canceling, Bluetooth Headphones (White, True Wireless)', 'images': ['https://m.media-amazon.com/images/I/61Amk1yTq7L.jpg'], 'currency': 'EGP', 'price': 440.0, 'rating': 3.1}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0BYVXRW7T', 'name': 'AirPods Pro 2 Semi-Original | Features Pure Sound, Stereo Sound & Premium Microphone, Compatible with All NWang Android and iPhone Mobile Phones, white Headphones Headset', 'images': ['https://m.media-amazon.com/images/I/41SmAmtQyML.jpg'], 'currency': 'EGP', 'price': 477.0, 'rating': 3.0}]}, {'type': 'noonProducts', 'id': UUID('e283d9fa-1647-45ef-8831-85d8f3572374'), 'interaction_id': UUID('6b46aa0e-b110-428e-b4df-74e92af9d47c'), 'role': 'assistant', 'createdAt': 1736681274704, 'products': [{'platform': 'noon', 'country': 'eg', 'asin': 'ZB13C3516FE391C2E57E5Z', 'name': 'Generic Air Pods (3rd generation) With Lightning Charging Case - White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB13C3516FE391C2E57E5Z/45/_/1724569601/03d2ccc8-be9f-441d-96af-f631bf7a4ca8.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZB13C3516FE391C2E57E5Z/45/_/1724569612/7e224386-2497-4111-8186-e37f477bdeb0.jpg'], 'currency': 'EGP', 'price': 359.0, 'rating': 3.8}, {'platform': 'noon', 'country': 'eg', 'asin': 'N70108365V', 'name': 'Apple AirPods 4 Wireless Earbuds, Bluetooth Headphones, with Active Noise Cancellation, Adaptive Audio, Transparency Mode, Personalized Spatial Audio, USB-C Charging Case, Wireless Charging, H2 Chip White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108365V/45/_/1725956901/85c7073d-6f07-4b4a-95eb-ec95ac7b6e73.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108365V/45/_/1725956903/b64c875c-d3d7-4026-a85c-410b4c5b659f.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108365V/45/_/1725956904/d2f36fc3-3a9a-4755-a05f-e91d1c649007.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108365V/45/_/1725956905/f2eb7916-4e09-404f-9e7b-1b81ac768fd3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108365V/45/_/1725956908/cf5bfc4a-3fcb-46db-9f2a-a93b609e1fe7.jpg'], 'currency': 'EGP', 'price': 9769.0, 'rating': 4.5}, {'platform': 'noon', 'country': 'eg', 'asin': 'N70108364V', 'name': 'Apple AirPods 4 Wireless Earbuds, Bluetooth Headphones, Personalized Spatial Audio, Sweat and Water Resistant, USB-C Charging Case, H2 Chip, Up to 30 Hours of Battery Life, Effortless Setup For IPhone White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108364V/45/_/1725956901/05cf4ef9-843f-4d7b-bb81-ae39e8b7972a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108364V/45/_/1725956901/14d18751-e082-4c34-9106-61be2cc000dc.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108364V/45/_/1725956905/d5faa265-f356-4eec-9957-481c626f39ba.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108364V/45/_/1725956906/8a683950-7a07-4122-80e9-4d3b28a5ba9e.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N70108364V/45/_/1725956907/2870c69d-7768-4b83-a0a0-0b71a7d7ba10.jpg'], 'currency': 'EGP', 'price': 8162.0, 'rating': 4.5}, {'platform': 'noon', 'country': 'eg', 'asin': 'N51445769A', 'name': 'Apple AirPods (3rd generation) with MagSafe Charging Case White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1667497500/N51445769A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1667497501/N51445769A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1667497501/N51445769A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1667497501/N51445769A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1667497501/N51445769A_5.jpg'], 'currency': 'EGP', 'price': 8950.0, 'rating': 4.3}, {'platform': 'noon', 'country': 'eg', 'asin': 'N53437240A', 'name': 'Apple AirPods Pro 2 Wireless Earbuds, Bluetooth Headphones, Active Noise Cancellation, Hearing Aid Feature, Transparency, Personalized Spatial Audio, High-Fidelity Sound, H2 Chip, USB-C Charging White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437240A/45/_/1694760182/fef39d70-943d-4962-a62b-f09196c604ab.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437240A/45/_/1694760183/6fbfbb24-6fcf-403c-8c34-7369bba7688a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437240A/45/_/1694760184/577f7c65-52c1-40f1-a95b-a71cf2465755.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437240A/45/_/1694760186/ef73a8ef-acce-4edd-84fc-3d5aa43d823c.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437240A/45/_/1694760187/2c1c8a27-d05f-4ea6-bc99-bd481275945f.jpg'], 'currency': 'EGP', 'price': 11658.0, 'rating': 4.4}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z827514522D9C76A1FBEDZ', 'name': 'Generic AirPods Pro Headphone Compatible with Android iPhone White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z827514522D9C76A1FBEDZ/45/_/1724569197/d65783d0-fd19-4719-98f3-f9d2107fdcb7.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z827514522D9C76A1FBEDZ/45/_/1724569417/1bbb1710-0c1f-49c0-83fd-ce27181445d3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z827514522D9C76A1FBEDZ/45/_/1724569420/2a30fa9c-b2ec-4b4d-b4eb-aaf988aa6b91.jpg'], 'currency': 'EGP', 'price': 364.0, 'rating': 3.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z1BAA59FC879F247BF08EZ', 'name': 'OneOdio OneAudio Noise Cancelling Headphones Wireless Bluetooth Headphones with 30 dB Hybrid Active Noise Cancelling and 30 Hours Playtime & Built-in Microphone Hands-Free Over Ear Headset ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1BAA59FC879F247BF08EZ/45/_/1734956841/4eae0001-ecda-4c3c-9834-4086e5b6185b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1BAA59FC879F247BF08EZ/45/_/1734956845/65df78df-2e24-4294-a894-c51825c6e15e.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1BAA59FC879F247BF08EZ/45/_/1734956852/390cb06b-e84c-4e55-91c8-65abe39e94eb.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1BAA59FC879F247BF08EZ/45/_/1734956863/0dc128cc-39e0-4766-89ae-acee98040d6b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z1BAA59FC879F247BF08EZ/45/_/1734956880/017f7d64-18a1-4166-867b-5cd6b9e0d2c2.jpg'], 'currency': 'EGP', 'price': 10800.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'eg', 'asin': 'N53437242A', 'name': 'Apple Earpods with USB-C White ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437242A/45/_/1695027841/50b78aff-7070-4981-9fc9-6a7cd70d69ff.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437242A/45/_/1695027842/e2dbab91-c6e3-41c7-af54-c5f7ce551da9.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437242A/45/_/1695027843/77d07d7e-bcdd-448b-b7db-8cfdc5f7db8b.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437242A/45/_/1695027922/f84ed25c-566a-48dd-9944-0ea5c69a39f3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N53437242A/45/_/1695028205/5a8645e8-4f4a-4acd-899e-f3cb658daa87.jpg'], 'currency': 'EGP', 'price': 1010.0, 'rating': 4.0}]}]
2025-01-12 11:27:55,079 [INFO] app.logs.logger: Received chat_next request for interaction_id: 6b46aa0e-b110-428e-b4df-74e92af9d47c
2025-01-12 11:27:55,087 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-12 11:27:55,087 [INFO] app.logs.logger: Fetching interaction with ID: 6b46aa0e-b110-428e-b4df-74e92af9d47c
2025-01-12 11:27:55,092 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 6b46aa0e-b110-428e-b4df-74e92af9d47c
2025-01-12 13:33:45,870 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-12 13:33:45,885 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:33:45,886 [INFO] app.logs.logger: Fetching chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:33:45,892 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:33:47,987 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-12 13:33:47,990 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:33:47,991 [INFO] app.logs.logger: Creating a new chat session for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05 with title: New Session
2025-01-12 13:33:47,997 [INFO] app.logs.logger: Successfully created new chat session with session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:48,187 [INFO] app.logs.logger: Received chat_history request for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:48,191 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-12 13:33:48,191 [INFO] app.logs.logger: Fetching interactions for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:48,193 [INFO] app.logs.logger: No interactions found for session_id: a038026e-d7e4-490d-b829-f18d87252229. Returning default greeting.
2025-01-12 13:33:54,635 [INFO] app.logs.logger: Received chat request for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:54,643 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:33:54,644 [INFO] app.logs.logger: Processing message for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:54,644 [INFO] app.logs.logger: Starting MessageChain for session_id: a038026e-d7e4-490d-b829-f18d87252229 with message: boxing wrap
2025-01-12 13:33:54,645 [INFO] app.logs.logger: Initializing ConversationState for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:54,647 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:33:54,649 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 13:33:55,372 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['boxing wrap'], 'search_index': 'Sports & Outdoors'}
2025-01-12 13:33:55,373 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-12 13:33:55,381 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-12 13:34:09,497 [INFO] app.logs.logger: Saving interaction to database.
2025-01-12 13:34:09,505 [INFO] app.logs.logger: INTERACTION SAVED:4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3
2025-01-12 13:34:09,505 [INFO] app.logs.logger: Formatting state for app response.
2025-01-12 13:34:09,505 [INFO] app.logs.logger: Formatting app reply for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:34:09,506 [INFO] app.logs.logger: Returning response for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:34:09,506 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('bf1857d7-a862-4c9e-acd1-9fe2131cbd54'), 'interaction_id': UUID('4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3'), 'role': 'assistant', 'createdAt': 1736688849506, 'products': [{'platform': 'amazon', 'country': 'eg', 'asin': 'B08XS1K9LD', 'name': 'Venum boxing hand wraps, 2 pieces - red', 'images': ['https://m.media-amazon.com/images/I/51BMaDXuNxL.jpg'], 'currency': 'EGP', 'price': 160.0, 'rating': 3.9}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B08XRX45RG', 'name': 'Venum boxing hand wrap punching bandage - 2pcs - black', 'images': ['https://m.media-amazon.com/images/I/818my32FCfL.jpg'], 'currency': 'EGP', 'price': 183.0, 'rating': 3.5}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0B5VHPYXW', 'name': 'Boxing Gloves MMA Hand Boxing Gloves Rubber Hand Grip Protection 3M-5M Bandages Boxing Wraps Boxing Gloves (2 PCS) by SportQ Lite', 'images': ['https://m.media-amazon.com/images/I/61VabH53qdL.jpg'], 'currency': 'EGP', 'price': 135.0, 'rating': 3.8}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B08WJMN82J', 'name': 'adidas boxing hand wraps - yellow', 'images': ['https://m.media-amazon.com/images/I/715fp9TJfcL.jpg'], 'currency': 'EGP', 'price': 319.0, 'rating': 4.6}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CWZ3TG9G', 'name': 'QSHOPÂ® LiteFighter Boxing Hand Wraps Multi Length Semi Elastic Hand Wraps with Thumb Loop for Boxing, Great Elastic Hand Wraps for Men and Women (2 Pack)', 'images': ['https://m.media-amazon.com/images/I/7125gAI-YOL.jpg'], 'currency': 'EGP', 'price': 230.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0149TTBE8', 'name': 'adidas Boxing Crepe Bandage New AIBA Rules', 'images': ['https://m.media-amazon.com/images/I/81lh0lVusSL.jpg'], 'currency': 'EGP', 'price': 557.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DJ699415', 'name': 'Generic. Essential Guide to Boxing Hand Wraps Protection and Performance for Intense Workouts Made Of High Quality 3 Meters - Blue', 'images': ['https://m.media-amazon.com/images/I/710RIvM60VL.jpg'], 'currency': 'EGP', 'price': 121.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DQLPZSH8', 'name': 'Venumm Boxing Hand Wrap', 'images': ['https://m.media-amazon.com/images/I/41RzqXKaVJL.jpg'], 'currency': 'EGP', 'price': 185.0, 'rating': 3.4}]}, {'type': 'noonProducts', 'id': UUID('c9df3e0c-048a-4f04-be7e-7002bf6cd00b'), 'interaction_id': UUID('4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3'), 'role': 'assistant', 'createdAt': 1736688849506, 'products': [{'platform': 'noon', 'country': 'eg', 'asin': 'N38132222A', 'name': 'Athlete Home Pull up Hand Wrap ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N38132222A/45/_/1713879611/98ed51e1-a594-42bc-bf6f-25e89abee00e.jpg'], 'currency': 'EGP', 'price': 77.2, 'rating': 4.2}, {'platform': 'noon', 'country': 'eg', 'asin': 'ZD060EEB6A5A49D31231AZ', 'name': 'VENUM 3.5M Boxing Hand Wraps Punching Bandage 2Pcs, Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZD060EEB6A5A49D31231AZ/45/_/1694514034/dd02a46f-a01c-407b-ace6-fdc355a9c967.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZD060EEB6A5A49D31231AZ/45/_/1694514036/791bad85-f87f-4c88-9b36-822e6ec14ad5.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZD060EEB6A5A49D31231AZ/45/_/1694514046/d58a362c-c296-4d5d-9f62-1ec798fed12c.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZD060EEB6A5A49D31231AZ/45/_/1694514047/d649fcb4-36de-49bc-a7d8-4f04f125a00a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZD060EEB6A5A49D31231AZ/45/_/1694514048/1e02db36-5561-449d-b951-1a43806cc3cb.jpg'], 'currency': 'EGP', 'price': 259.0, 'rating': 4.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z6E30A8ABD8577073CDA1Z', 'name': 'VENUM 4.5M Boxing Hand Wraps Punching Bandage 2Pcs, Black ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6E30A8ABD8577073CDA1Z/45/_/1686479696/302023e6-69c3-4340-bfb3-684eb3939028.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6E30A8ABD8577073CDA1Z/45/_/1686479697/4d3dca6b-655d-482f-a3c6-7668b06a9534.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6E30A8ABD8577073CDA1Z/45/_/1686479706/2adeb275-44d2-4634-a568-76d029fd6b40.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6E30A8ABD8577073CDA1Z/45/_/1701537601/4141a79a-d8ea-44a4-b6d9-8dfd3598a17d.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z6E30A8ABD8577073CDA1Z/45/_/1701537621/94364a3c-539c-46b7-9bc2-7fb652313b1e.jpg'], 'currency': 'EGP', 'price': 289.0, 'rating': 3.9}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z40547A2BBD9947BD58A5Z', 'name': 'VENUM 3.5M Boxing Hand Wraps Punching Bandage 2Pcs, Red ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z40547A2BBD9947BD58A5Z/45/_/1694261831/e1b678de-f95d-40c4-a5aa-8efc91f5b690.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z40547A2BBD9947BD58A5Z/45/_/1694261834/79ce1ff2-fd9a-4f3c-b7fc-c4d5bcec295a.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z40547A2BBD9947BD58A5Z/45/_/1694261839/90a188b1-b589-448b-aa08-5afcfb4a06ed.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z40547A2BBD9947BD58A5Z/45/_/1694262716/019f54c0-e3e4-4eb5-bf94-081c64eb64ce.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z40547A2BBD9947BD58A5Z/45/_/1694262717/ed9f736f-4fd4-431a-ab07-d2dc2819b59f.jpg'], 'currency': 'EGP', 'price': 259.0, 'rating': 4.5}, {'platform': 'noon', 'country': 'eg', 'asin': 'ZF482C8262E458BA16ADBZ', 'name': 'VENUM 3.5M Boxing Hand Wraps Punching Bandage 2Pcs, Blue ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZF482C8262E458BA16ADBZ/45/_/1694266057/3c074861-d84d-4950-ab66-fabf449d0b30.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZF482C8262E458BA16ADBZ/45/_/1694266059/743d5eee-9ee4-47b0-9f7c-2462b9529800.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZF482C8262E458BA16ADBZ/45/_/1694266066/32fde073-5972-4804-a356-a86417020d35.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZF482C8262E458BA16ADBZ/45/_/1694266067/71bd066c-7fab-465e-9cf8-fbfda5f5ffe8.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/ZF482C8262E458BA16ADBZ/45/_/1694266070/a65640e3-d94e-4ef9-8193-63512aaa30e5.jpg'], 'currency': 'EGP', 'price': 259.0, 'rating': 4.5}, {'platform': 'noon', 'country': 'eg', 'asin': 'N31152225A', 'name': 'Adidas Head Guard With Chin Prot Size Large Large ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1671016579/N31152225A_4.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1671016579/N31152225A_5.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692176494/N31152225A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692176494/N31152225A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1692176494/N31152225A_3.jpg'], 'currency': 'EGP', 'price': 3579.0, 'rating': 5.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'N43219152A', 'name': 'Generic Super Powerful Workout Kit 976grams ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'EGP', 'price': 180.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'eg', 'asin': 'N48000671A', 'name': 'Adidas Boxing Crepe Bandage 2.55 meter ', 'images': ['https://upload.wikimedia.org/wikipedia/commons/thumb/c/ca/Noon_Website_Logo.svg/260px-Noon_Website_Logo.svg.png'], 'currency': 'EGP', 'price': 489.0, 'rating': 5.0}]}]
2025-01-12 13:34:09,777 [INFO] app.logs.logger: Received chat_next request for interaction_id: 4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3
2025-01-12 13:34:09,782 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-12 13:34:09,783 [INFO] app.logs.logger: Fetching interaction with ID: 4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3
2025-01-12 13:34:09,789 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 4a03b1a5-4187-48e0-b6e3-7b1d2ebc69c3
2025-01-12 13:36:49,546 [INFO] app.logs.logger: Received chat request for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:49,633 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-12 13:36:49,634 [INFO] app.logs.logger: Processing message for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:49,634 [INFO] app.logs.logger: Starting MessageChain for session_id: a038026e-d7e4-490d-b829-f18d87252229 with message: filter out the non relvant results and show only the hand wraps
2025-01-12 13:36:49,635 [INFO] app.logs.logger: Initializing ConversationState for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:49,638 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:49,641 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-12 13:36:52,263 [INFO] app.logs.logger: Processing tool call: display_products with arguments: {'productIds': ['B08XS1K9LD', 'B08XRX45RG', 'B0B5VHPYXW', 'B08WJMN82J', 'B0CWZ3TG9G', 'B0149TTBE8', 'B0DJ699415', 'B0DQLPZSH8', 'ZD060EEB6A5A49D31231AZ', 'Z6E30A8ABD8577073CDA1Z', 'Z40547A2BBD9947BD58A5Z', 'ZF482C8262E458BA16ADBZ', 'N48000671A']}
2025-01-12 13:36:52,264 [WARNING] app.logs.logger: Unrecognized tool call: display_products
2025-01-12 13:36:52,273 [INFO] app.logs.logger: INTERACTION SAVED:dd99c198-b75e-48f7-9959-2d3959db6263
2025-01-12 13:36:52,273 [INFO] app.logs.logger: Saved interaction for unrecognized tool call. Returning response.
2025-01-12 13:36:52,274 [INFO] app.logs.logger: Formatting app reply for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:52,274 [INFO] app.logs.logger: Returning response for session_id: a038026e-d7e4-490d-b829-f18d87252229
2025-01-12 13:36:52,275 [INFO] app.logs.logger: Response:
[]
2025-01-14 12:39:53,656 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-14 12:39:53,802 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-14 12:39:53,803 [INFO] app.logs.logger: Creating a new chat session for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05 with title: New Session
2025-01-14 12:39:53,819 [INFO] app.logs.logger: Successfully created new chat session with session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:39:53,943 [INFO] app.logs.logger: Received chat_history request for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:39:53,946 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-14 12:39:53,946 [INFO] app.logs.logger: Fetching interactions for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:39:53,976 [INFO] app.logs.logger: No interactions found for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a. Returning default greeting.
2025-01-14 12:40:13,875 [INFO] app.logs.logger: Received chat request for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:13,886 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-14 12:40:13,887 [INFO] app.logs.logger: Processing message for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:13,887 [INFO] app.logs.logger: Starting MessageChain for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a with message: i need a new screen protector for my macbook air 13
2025-01-14 12:40:13,896 [INFO] app.logs.logger: Initializing ConversationState for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:13,901 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:13,904 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-14 12:40:15,466 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['screen protector', 'MacBook Air 13'], 'search_index': 'All'}
2025-01-14 12:40:15,467 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-14 12:40:15,478 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-14 12:40:26,040 [INFO] app.logs.logger: Saving interaction to database.
2025-01-14 12:40:26,048 [INFO] app.logs.logger: INTERACTION SAVED:018c7ab1-3d57-4ebd-8b5d-3295a1078742
2025-01-14 12:40:26,049 [INFO] app.logs.logger: Formatting state for app response.
2025-01-14 12:40:26,049 [INFO] app.logs.logger: Formatting app reply for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:26,049 [INFO] app.logs.logger: Returning response for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:40:26,050 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('b6d8abae-ea34-40ce-8ef7-79cb44e5b232'), 'interaction_id': UUID('018c7ab1-3d57-4ebd-8b5d-3295a1078742'), 'role': 'assistant', 'createdAt': 1736858426049, 'products': [{'platform': 'amazon', 'country': 'eg', 'asin': 'B0CNJSFL5G', 'name': 'Dl3 Mobilak Screen Protector For MacBook Pro 13 inch (2016-2022 / M1, M2) and MacBook Air 13 inch (2018-2021 / M1) Glare Reducer Screen Protector, Anti Fingerprint Laptop Screen Protector', 'images': ['https://m.media-amazon.com/images/I/41nMLpw5OeL.jpg'], 'currency': 'EGP', 'price': 150.0, 'rating': 2.6}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0B1QCDC1H', 'name': 'FINDING CASE Clear Screen Protector for MacBook Air 13-inch Model A1369 / A1466 (Mid 2009 to 2017) / Macbook White A1342 - Anti Scratch LCD Display Protection Full Cover Film', 'images': ['https://m.media-amazon.com/images/I/61T7j0q4IWL.jpg'], 'currency': 'EGP', 'price': 130.0, 'rating': 3.8}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B09F3BC6CF', 'name': 'ProCase Pack of 2 9H Hardness Screen Protectors for 13 Inch MacBook Pro 13 / MacBook Air 13, Tempered Glass Screen Protector - Clear', 'images': ['https://m.media-amazon.com/images/I/615ExAI4PPL.jpg'], 'currency': 'EGP', 'price': 899.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0B56LSGM1', 'name': "ANTOGOO V 2 Pack Compatible with MacBook Air 13.6 Inch Screen Protector (M2/M3), Anti Glare Film Matte Laptop Screen Protector for Mac 13.6''(A2681,A3113)", 'images': ['https://m.media-amazon.com/images/I/71EM85dJFYL.jpg'], 'currency': 'EGP', 'price': 699.0, 'rating': 4.3}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0D3YT1T1G', 'name': 'Crystal Clear LCD Screen Protector for Apple 13, 13.3 inch Macbook Air/Pro', 'images': ['https://m.media-amazon.com/images/I/61d1VFa-a5L.jpg'], 'currency': 'EGP', 'price': 145.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B08ZM1678X', 'name': 'WIWU Screen Protector For MacBook Air 13", Clear|18 Months Warranty', 'images': ['https://m.media-amazon.com/images/I/713GxEf8k2L.jpg'], 'currency': 'EGP', 'price': 388.0, 'rating': 5.0}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DBGNQDFX', 'name': 'Glass Screen Protector for 13" MacBook Pro 13 M2 M1 2016-2022, MacBook Air 13 M1 2018-2021 (Pro Model: M2 M1 A2338 A2289 A2251 A2289 A2251 A2159 A1706 A1708 A1989, Air Model: A2337 M1 A2179 A1932)', 'images': ['https://m.media-amazon.com/images/I/61odhYvID4L.jpg'], 'currency': 'EGP', 'price': 419.0, 'rating': 1.7}]}, {'type': 'noonProducts', 'id': UUID('5e939bce-0eb8-437d-b4bf-8c6551fd7114'), 'interaction_id': UUID('018c7ab1-3d57-4ebd-8b5d-3295a1078742'), 'role': 'assistant', 'createdAt': 1736858426049, 'products': [{'platform': 'noon', 'country': 'eg', 'asin': 'N41964615A', 'name': 'Apple MacBook Air MGN63 With 13-Inch Retina (2560x1600) Display, M1 Chip With 8-Core Processor And 7-Core Graphics/8GB RAM DDR4/256GB SSD/English Arabic Keyboard Space Grey ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pnsku/N41964615A/45/_/1710144325/756d8702-be94-4710-a2a7-6425bb553d75.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1669724767/N41964615A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1669724767/N41964615A_3.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1669724767/N41964615A_5.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1669724768/N41964615A_4.jpg'], 'currency': 'EGP', 'price': 39879.0, 'rating': 4.6}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z58F807B47089F172F112Z', 'name': 'Generic Tempered Glass Screen Protector for iPad Pro 13 Inch 2024 / iPad Air 13 Inch 2024 Tablet, 9H Hardness Screen Protector Zero Bubble Screen Protector Transparent ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z58F807B47089F172F112Z/45/_/1731182096/048214e9-7535-4e58-a74a-7b069856cf2e.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z58F807B47089F172F112Z/45/_/1731182098/7839a440-1b07-473f-b97f-b500237631ff.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z58F807B47089F172F112Z/45/_/1731182099/0057cac4-2401-4e77-b0ea-0a3a7b2533ae.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z58F807B47089F172F112Z/45/_/1731182099/40e13ded-20f8-45d3-9666-e8e2beaa7d95.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z58F807B47089F172F112Z/45/_/1731182100/ba0437d3-223c-479a-8773-284bfda410e9.jpg'], 'currency': 'EGP', 'price': 299.0, 'rating': 5.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z7C3B0BA56632DEC56712Z', 'name': 'Generic Clear Screen Protector for MacBook Air 13-inch Model A1369 / A1466 (Mid 2009 to 2017)Anti Scratch LCD Display Protection Full Cover Film ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z7C3B0BA56632DEC56712Z/45/_/1706035537/e49dcf37-d7d0-4482-af8c-2cd4cdaf1747.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z7C3B0BA56632DEC56712Z/45/_/1706035547/6f6a688f-ecd2-4de2-a418-e406d8092c91.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z7C3B0BA56632DEC56712Z/45/_/1706035557/15f722da-ef0b-4e6b-90f9-d1542c1e01a9.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z7C3B0BA56632DEC56712Z/45/_/1706035558/7d36e8aa-06eb-4412-bc90-1b756328355c.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z7C3B0BA56632DEC56712Z/45/_/1706035568/6e418bb8-375c-4941-8f7e-4715c32e3146.jpg'], 'currency': 'EGP', 'price': 130.0, 'rating': 4.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'Z149CE6CA0ACED6F86AF6Z', 'name': 'Generic Microfiber Cleaning Cloth Keyboard and Screen Protector Compatible with MacBook Pro 13 "Macbook Pro 14" and MacBook Air 13 (15 inch) ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/pzsku/Z149CE6CA0ACED6F86AF6Z/45/_/1713825931/22fe4bc1-4458-44b6-931c-ab0bec69ae55.jpg'], 'currency': 'EGP', 'price': 838.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'eg', 'asin': 'N26366006A', 'name': 'XbotMax New Hard Laptop Skin For Apple MacBook Air Pink ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1559495443/N26366006A_1.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1559495443/N26366006A_2.jpg'], 'currency': 'EGP', 'price': 257.0, 'rating': 1.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'N26366005A', 'name': 'XbotMax New Hard Laptop Skin For Apple MacBook Air Blue ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1559495442/N26366005A_2.jpg', 'https://api.arobah.com/image/https://f.nooncdn.com/p/v1559495443/N26366005A_1.jpg'], 'currency': 'EGP', 'price': 257.0, 'rating': 1.0}, {'platform': 'noon', 'country': 'eg', 'asin': 'N51775246A', 'name': 'Generic Air Force Wife Skin Cover For Macbook Air 13 2020 Multicolour ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1636311901/N51775246A_1.jpg'], 'currency': 'EGP', 'price': 196.0, 'rating': 3.4}, {'platform': 'noon', 'country': 'eg', 'asin': 'N51775674A', 'name': 'Generic Of Air And Sea Skin Cover For Macbook Air 13 2020 Multicolour ', 'images': ['https://api.arobah.com/image/https://f.nooncdn.com/p/v1636311647/N51775674A_1.jpg'], 'currency': 'EGP', 'price': 196.0, 'rating': 3.4}]}]
2025-01-14 12:40:26,522 [INFO] app.logs.logger: Received chat_next request for interaction_id: 018c7ab1-3d57-4ebd-8b5d-3295a1078742
2025-01-14 12:40:26,526 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-14 12:40:26,526 [INFO] app.logs.logger: Fetching interaction with ID: 018c7ab1-3d57-4ebd-8b5d-3295a1078742
2025-01-14 12:40:26,529 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 018c7ab1-3d57-4ebd-8b5d-3295a1078742
2025-01-14 12:41:23,949 [INFO] app.logs.logger: Received chat request for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:23,966 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-14 12:41:23,966 [INFO] app.logs.logger: Processing message for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:23,967 [INFO] app.logs.logger: Starting MessageChain for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a with message: show me the noon optioins after removing the non-relevant products (skins and covers)
2025-01-14 12:41:23,968 [INFO] app.logs.logger: Initializing ConversationState for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:23,970 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:23,974 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-14 12:41:25,128 [INFO] app.logs.logger: Processing tool call: display_products with arguments: {'productIds': ['Z58F807B47089F172F112Z', 'Z7C3B0BA56632DEC56712Z']}
2025-01-14 12:41:25,129 [INFO] app.logs.logger: Handling 'display_products' tool call.
2025-01-14 12:41:25,132 [ERROR] app.logs.logger: Error during 'display_products' tool call: 'NoneType' object has no attribute 'platform'
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/search_agent.py", line 405, in MessageChain
    'platform': product.platform,
                ^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'platform'
2025-01-14 12:41:25,134 [INFO] app.logs.logger: Formatting app reply for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:25,134 [INFO] app.logs.logger: Returning response for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-14 12:41:25,135 [INFO] app.logs.logger: Response:
[]
2025-01-14 12:47:28,810 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-14 12:47:28,875 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-14 12:47:28,875 [INFO] app.logs.logger: Fetching chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-14 12:47:28,882 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:08:06,789 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-16 14:08:06,808 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:08:06,808 [INFO] app.logs.logger: Creating a new chat session for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05 with title: New Session
2025-01-16 14:08:06,831 [INFO] app.logs.logger: Successfully created new chat session with session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:08:06,912 [INFO] app.logs.logger: Received chat_history request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:08:06,915 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-16 14:08:06,915 [INFO] app.logs.logger: Fetching interactions for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:08:06,959 [INFO] app.logs.logger: No interactions found for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17. Returning default greeting.
2025-01-16 14:24:44,689 [INFO] app.logs.logger: Received chat request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:44,765 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:24:44,766 [INFO] app.logs.logger: Processing message for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:44,766 [INFO] app.logs.logger: Starting MessageChain for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17 with message: hi
2025-01-16 14:24:44,771 [INFO] app.logs.logger: Initializing ConversationState for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:44,776 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:44,795 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-16 14:24:46,369 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-16 14:24:46,385 [INFO] app.logs.logger: INTERACTION SAVED:8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,385 [INFO] app.logs.logger: Formatting app reply for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:46,386 [INFO] app.logs.logger: Returning response for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:24:46,386 [INFO] app.logs.logger: Response:
[{'type': 'text', 'id': UUID('a4ead571-f6c0-4835-912b-1cde02009cc9'), 'interaction_id': UUID('8f3fec9e-044f-4726-9459-4be7cc26fc78'), 'role': 'assistant', 'createdAt': 1737037486386, 'text': 'Well, hello there! ðŸŽ‰ What fabulous shopping adventure can I assist you with today? Looking for something specific or just browsing for some retail therapy? ðŸ›ï¸âœ¨'}]
2025-01-16 14:24:46,557 [INFO] app.logs.logger: Received chat_next request for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,562 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:24:46,563 [INFO] app.logs.logger: Fetching interaction with ID: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,566 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,567 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:24:46,656 [INFO] app.logs.logger: Received chat_next request for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,661 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:24:46,661 [INFO] app.logs.logger: Fetching interaction with ID: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,663 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,663 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:24:46,748 [INFO] app.logs.logger: Received chat_next request for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,752 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:24:46,753 [INFO] app.logs.logger: Fetching interaction with ID: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,754 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,755 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:24:46,843 [INFO] app.logs.logger: Received chat_next request for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,848 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:24:46,849 [INFO] app.logs.logger: Fetching interaction with ID: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,851 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,852 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:24:46,943 [INFO] app.logs.logger: Received chat_next request for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,947 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:24:46,948 [INFO] app.logs.logger: Fetching interaction with ID: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,949 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 8f3fec9e-044f-4726-9459-4be7cc26fc78
2025-01-16 14:24:46,950 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:25:02,968 [INFO] app.logs.logger: Received chat request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:02,985 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:25:02,986 [INFO] app.logs.logger: Processing message for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:02,987 [INFO] app.logs.logger: Starting MessageChain for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17 with message: i need a new iphone 16 pro 256GB
2025-01-16 14:25:02,988 [INFO] app.logs.logger: Initializing ConversationState for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:02,992 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:02,995 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-16 14:25:05,923 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['iphone 16 pro 256GB'], 'search_index': 'electronics'}
2025-01-16 14:25:05,924 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-16 14:25:05,939 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-16 14:25:11,635 [INFO] app.logs.logger: Saving interaction to database.
2025-01-16 14:25:11,646 [INFO] app.logs.logger: INTERACTION SAVED:18ceeefa-cf1f-45bb-9524-6d8ccde302a1
2025-01-16 14:25:11,648 [INFO] app.logs.logger: Formatting state for app response.
2025-01-16 14:25:11,648 [INFO] app.logs.logger: Formatting app reply for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:11,649 [INFO] app.logs.logger: Returning response for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:25:11,650 [INFO] app.logs.logger: Response:
[]
2025-01-16 14:26:25,253 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-16 14:26:25,265 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:25,265 [INFO] app.logs.logger: Fetching chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:25,280 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:26,852 [INFO] app.logs.logger: Received chat_history request for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-16 14:26:26,858 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-16 14:26:26,858 [INFO] app.logs.logger: Fetching interactions for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-16 14:26:26,862 [INFO] app.logs.logger: Formatted chat history for session_id: f223e7e4-1224-4e0e-9af9-6815d2fd208a
2025-01-16 14:26:28,255 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-16 14:26:28,260 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:28,260 [INFO] app.logs.logger: Fetching chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:28,264 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:26:29,664 [INFO] app.logs.logger: Received chat_history request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:26:29,671 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-16 14:26:29,671 [INFO] app.logs.logger: Fetching interactions for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:26:29,673 [INFO] app.logs.logger: Formatted chat history for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:08,525 [INFO] app.logs.logger: Received chat request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:08,537 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:29:08,538 [INFO] app.logs.logger: Processing message for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:08,538 [INFO] app.logs.logger: Starting MessageChain for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17 with message: ?
2025-01-16 14:29:08,539 [INFO] app.logs.logger: Initializing ConversationState for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:08,542 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:08,544 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-16 14:29:09,806 [INFO] app.logs.logger: No tool calls detected in LLM response. Saving interaction.
2025-01-16 14:29:09,816 [INFO] app.logs.logger: INTERACTION SAVED:418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:09,816 [INFO] app.logs.logger: Formatting app reply for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:09,816 [INFO] app.logs.logger: Returning response for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:09,816 [INFO] app.logs.logger: Response:
[{'type': 'text', 'id': UUID('9d18813c-3451-4670-8272-677a93e51e32'), 'interaction_id': UUID('418be28d-5711-4c9b-a247-68e9493e92f4'), 'role': 'assistant', 'createdAt': 1737037749816, 'text': "Looks like the iPhone 16 Pro 256GB is playing hard to get! ðŸ˜… No worries, let's try to broaden our search a bit. \n\nWould you like me to look for the iPhone 16 in different storage options or perhaps check out other models? Let me know your preference! ðŸ“±âœ¨"}]
2025-01-16 14:29:09,982 [INFO] app.logs.logger: Received chat_next request for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:09,987 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:09,988 [INFO] app.logs.logger: Fetching interaction with ID: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:09,990 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:09,990 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:10,078 [INFO] app.logs.logger: Received chat_next request for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,082 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:10,082 [INFO] app.logs.logger: Fetching interaction with ID: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,084 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,085 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:10,161 [INFO] app.logs.logger: Received chat_next request for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,166 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:10,166 [INFO] app.logs.logger: Fetching interaction with ID: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,167 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,167 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:10,245 [INFO] app.logs.logger: Received chat_next request for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,249 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:10,250 [INFO] app.logs.logger: Fetching interaction with ID: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,256 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,257 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:10,346 [INFO] app.logs.logger: Received chat_next request for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,350 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:10,350 [INFO] app.logs.logger: Fetching interaction with ID: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,351 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 418be28d-5711-4c9b-a247-68e9493e92f4
2025-01-16 14:29:10,351 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:26,746 [INFO] app.logs.logger: Received chat request for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:26,761 [INFO] app.logs.logger: User authenticated successfully: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:29:26,762 [INFO] app.logs.logger: Processing message for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:26,762 [INFO] app.logs.logger: Starting MessageChain for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17 with message: search again
2025-01-16 14:29:26,762 [INFO] app.logs.logger: Initializing ConversationState for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:26,765 [INFO] app.logs.logger: Successfully initialized ConversationState for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05, country: eg, session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:26,768 [INFO] app.logs.logger: Fetching response from the LLM.
2025-01-16 14:29:27,617 [INFO] app.logs.logger: Processing tool call: search_products with arguments: {'keywords': ['iPhone 16 Pro 256GB'], 'search_index': 'electronics'}
2025-01-16 14:29:27,618 [INFO] app.logs.logger: Handling 'search_products' tool call.
2025-01-16 14:29:27,626 [INFO] app.logs.logger: Searching for products on Amazon and Noon.
2025-01-16 14:29:34,899 [INFO] app.logs.logger: Saving interaction to database.
2025-01-16 14:29:34,909 [INFO] app.logs.logger: INTERACTION SAVED:173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:34,909 [INFO] app.logs.logger: Formatting state for app response.
2025-01-16 14:29:34,909 [INFO] app.logs.logger: Formatting app reply for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:34,909 [INFO] app.logs.logger: Returning response for session_id: ab44403c-6fa5-4b27-8145-8d7373e4ac17
2025-01-16 14:29:34,909 [INFO] app.logs.logger: Response:
[{'type': 'amazonProducts', 'id': UUID('635b9a19-1a85-4c54-bf2c-dbf559b94a3d'), 'interaction_id': UUID('173c24a9-1abf-451c-8652-088b709031f6'), 'role': 'assistant', 'createdAt': 1737037774909, 'products': [{'platform': 'amazon', 'country': 'eg', 'asin': 'B0DFC73DWT', 'name': 'ZOEGAA iPhone 16 Pro Tempered Glass Privacy Screen, Tempered Glass iPhone 16 Pro Privacy Screen with Easy Installation Tool, 9H Hardness Full Cover iPhone 16 Pro Tempered Glass Privacy Screen, Fall', 'images': ['https://m.media-amazon.com/images/I/61jXs5fF9gL.jpg'], 'currency': 'EGP', 'price': 169.0, 'rating': 3.6}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DJH67T66', 'name': 'Bump Silicon TPU Shild Case Microfiber Lining with Camera Protection For Apple iPhone 16 Pro 6.1 Inch (White)', 'images': ['https://m.media-amazon.com/images/I/51HXw0rMr8L.jpg'], 'currency': 'EGP', 'price': 250.0, 'rating': 3.4}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0D9LFT53T', 'name': 'Anoowkoa [2+2 Pack for iPhone 16 Pro 6,3" Screen Protectors and Camera Lens Protectors Guard Tempered Glass Film, Anti Fingerprints Protective Film', 'images': ['https://m.media-amazon.com/images/I/71swdVSiOJL.jpg'], 'currency': 'EGP', 'price': 1335.0, 'rating': 3.9}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0DBLW3HHQ', 'name': 'Hoerrye For 16 Pro Max / 16 Pro Camera Protection, Scratch-Resistant, Stable, Ultra Clear 9H Hardness Camera Protection HD Tempered Metal Glass Camera Screen Protector Film Accessories Rose Gold', 'images': ['https://m.media-amazon.com/images/I/81lBuiCXxqL.jpg'], 'currency': 'EGP', 'price': 250.0, 'rating': 4.2}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CWQV8DB1', 'name': 'Nothing Phone (2a) 8/128 - Android 14 smartphone, 50MP dual camera, 5000 mAh Long battery life, 6.7â€ flexible AMOLED screen, Mediatek Dimensity 7200Pro, Black', 'images': ['https://m.media-amazon.com/images/I/6144AnrlZGL.jpg'], 'currency': 'EGP', 'price': 23499.0, 'rating': 4.4}, {'platform': 'amazon', 'country': 'eg', 'asin': 'B0CMCSR657', 'name': 'LISEN MagSafe Car Mount for iPhone 16 pro', 'images': ['https://m.media-amazon.com/images/I/71tY-tRfRwL.jpg'], 'currency': 'EGP', 'price': 1405.0, 'rating': 4.1}]}]
2025-01-16 14:29:35,658 [INFO] app.logs.logger: Received chat_next request for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,672 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:35,672 [INFO] app.logs.logger: Fetching interaction with ID: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,674 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,674 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:35,753 [INFO] app.logs.logger: Received chat_next request for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,757 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:35,758 [INFO] app.logs.logger: Fetching interaction with ID: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,759 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,760 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:35,864 [INFO] app.logs.logger: Received chat_next request for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,867 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:35,868 [INFO] app.logs.logger: Fetching interaction with ID: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,869 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:35,869 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:36,006 [INFO] app.logs.logger: Received chat_next request for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,010 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:36,010 [INFO] app.logs.logger: Fetching interaction with ID: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,012 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,012 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:29:36,092 [INFO] app.logs.logger: Received chat_next request for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,095 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, country=eg
2025-01-16 14:29:36,095 [INFO] app.logs.logger: Fetching interaction with ID: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,097 [INFO] app.logs.logger: Processing 'top_picks' for interaction_id: 173c24a9-1abf-451c-8652-088b709031f6
2025-01-16 14:29:36,097 [ERROR] app.logs.logger: Unexpected error in chat_next: list index out of range
Traceback (most recent call last):
  File "/home/admin/arobah/arobah_api/app/routers/chat.py", line 226, in chat_next
    response_unformatted = await nextTopPicks(db, country, interaction)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/admin/arobah/arobah_api/app/agents/chatAgent/chains_copy.py", line 324, in nextTopPicks
    search_keywords = interaction.search_keywords[-1]
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^
IndexError: list index out of range
2025-01-16 14:31:20,477 [INFO] app.logs.logger: Received request to fetch chat sessions.
2025-01-16 14:31:20,490 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:31:20,490 [INFO] app.logs.logger: Fetching chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-16 14:31:20,495 [INFO] app.logs.logger: Successfully fetched and formatted chat sessions for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-23 12:12:39,422 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-23 12:12:39,784 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05
2025-01-23 12:12:39,785 [INFO] app.logs.logger: Creating a new chat session for user_id: cd5a4723-4322-4fae-896e-6acfc1a66b05 with title: New Session
2025-01-23 12:12:39,925 [INFO] app.logs.logger: Successfully created new chat session with session_id: 8def2122-8e9c-421e-9db5-aace738dca60
2025-01-23 12:12:40,024 [INFO] app.logs.logger: Received chat_history request for session_id: 8def2122-8e9c-421e-9db5-aace738dca60
2025-01-23 12:12:40,029 [INFO] app.logs.logger: User authenticated successfully: user_id=cd5a4723-4322-4fae-896e-6acfc1a66b05, first_name=islam
2025-01-23 12:12:40,029 [INFO] app.logs.logger: Fetching interactions for session_id: 8def2122-8e9c-421e-9db5-aace738dca60
2025-01-23 12:12:40,048 [INFO] app.logs.logger: No interactions found for session_id: 8def2122-8e9c-421e-9db5-aace738dca60. Returning default greeting.
2025-01-24 12:35:23,411 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-24 12:35:23,520 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59
2025-01-24 12:35:23,520 [INFO] app.logs.logger: Creating a new chat session for user_id: 92d2dba2-0e34-47f8-ac24-65c014663e59 with title: New Session
2025-01-24 12:35:23,551 [INFO] app.logs.logger: Successfully created new chat session with session_id: 50e2f4ab-15b3-455d-91a3-fbec04024b4a
2025-01-24 12:35:23,746 [INFO] app.logs.logger: Received chat_history request for session_id: 50e2f4ab-15b3-455d-91a3-fbec04024b4a
2025-01-24 12:35:23,753 [INFO] app.logs.logger: User authenticated successfully: user_id=92d2dba2-0e34-47f8-ac24-65c014663e59, first_name=Islam
2025-01-24 12:35:23,753 [INFO] app.logs.logger: Fetching interactions for session_id: 50e2f4ab-15b3-455d-91a3-fbec04024b4a
2025-01-24 12:35:23,772 [INFO] app.logs.logger: No interactions found for session_id: 50e2f4ab-15b3-455d-91a3-fbec04024b4a. Returning default greeting.
2025-01-24 12:35:57,582 [INFO] app.logs.logger: Received request to create a new chat session.
2025-01-24 12:35:57,590 [INFO] app.logs.logger: User authenticated successfully: user_id=1666cb09-e226-441b-a5fe-a6b507fc92ce
2025-01-24 12:35:57,591 [INFO] app.logs.logger: Creating a new chat session for user_id: 1666cb09-e226-441b-a5fe-a6b507fc92ce with title: New Session
2025-01-24 12:35:57,601 [INFO] app.logs.logger: Successfully created new chat session with session_id: a5a4b5bc-5b44-4cfa-b29d-2fb7ed8735ae
2025-01-24 12:35:57,751 [INFO] app.logs.logger: Received chat_history request for session_id: a5a4b5bc-5b44-4cfa-b29d-2fb7ed8735ae
2025-01-24 12:35:57,756 [INFO] app.logs.logger: User authenticated successfully: user_id=1666cb09-e226-441b-a5fe-a6b507fc92ce, first_name=islam
2025-01-24 12:35:57,757 [INFO] app.logs.logger: Fetching interactions for session_id: a5a4b5bc-5b44-4cfa-b29d-2fb7ed8735ae
2025-01-24 12:35:57,761 [INFO] app.logs.logger: No interactions found for session_id: a5a4b5bc-5b44-4cfa-b29d-2fb7ed8735ae. Returning default greeting.
